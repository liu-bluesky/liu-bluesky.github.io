import"./vue-DSB24BnW.js";import{u as ae,a as se}from"./vue-router-fyTrc5Va.js";import re from"./deptTree-CoDmF0Qk.js";import{f as ne,j as F,r as ue}from"./index-CfbifT15.js";import{_ as de}from"./index-CR9DtD1f.js";import{d as ie,c as me,l as pe,a as B,b as fe,e as ce,f as _e,r as be}from"./user-nCxR8Gyc.js";import{b as ge}from"./config-YWakucQU.js";import{c as w,a as _}from"./element-plus-Cdmo8XhC.js";import{d as Ve,v,f as O,r as h,h as r,c as x,a as k,i as e,j as l,u as P,m as i,o as p,l as V,n as j,F as D,k as R}from"./@vue-CmN6Z9lx.js";import"./ace-builds-DiBK84cm.js";import"./vuex-CLkfaZ6_.js";import"./js-cookie-Cz0CWeBA.js";import"./path-browserify-Jw_v0k3c.js";import"./@vueuse-D81fD1wx.js";import"./nprogress-C9k5oxGd.js";import"./axios-BNZxzx77.js";import"./@element-plus-DGCe4rM-.js";/* empty css                    */import"./dayjs-BhI1duP8.js";import"./element-easy-form-Dkjp9jsl.js";import"./mockjs-72j0mDZC.js";import"./vuedraggable-C0hio2tq.js";import"./sortablejs-CUXm9Ppf.js";import"./vue3-ace-editor-YX3apWn1.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./uuid-CQkTLCs1.js";import"./vue-i18n-BPZ2p18e.js";import"./@intlify-fCQYzvHO.js";import"./element-easy-print-B_PXcQ-3.js";import"./vue3-draggable-resizable-yn-Cm3Ut1tY.js";import"./lodash-es-CiJSjksT.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-D3FX-SGt.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-B55MhO6l.js";const ye={class:"commonBoxmp"},we={class:"aic h100"},ve={class:"jcb aic w100"},he={class:"dialog-footer"},dt=Ve({__name:"index",setup(xe){ae(),se();const{parseTime:ke,addDateRange:Ie,getDict:$}=ne();let I=v({sys_job_status:[]});O(async()=>{I.sys_job_status=await $("sys_job_status")});const U=h();h(!0);const t=v({initPassword:"",height:0,deptOptions:[],form:{},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]},dateRange:[],postOptions:[],roleOptions:[],tableData:[],userVisible:!1,columnData:[{label:"用户名称",prop:"userName",visible:!0,renderHeader:({column:a})=>e(r("filterBox"),{title:a.label,valueKey:a.property,flterType:"input",onChange:m.value.handleFilterBox,data:m.value.formFilter},null)},{label:"用户昵称",prop:"nickName",visible:!0,renderHeader:({column:a})=>e(r("filterBox"),{title:a.label,valueKey:a.property,flterType:"input",onChange:m.value.handleFilterBox,data:m.value.formFilter},null)},{label:"部门",prop:"dept.deptName",visible:!0},{label:"手机号",prop:"phonenumber",visible:!0},{label:"状态",prop:"status",visible:!0,render:({row:a})=>e(de,{values:a.status,dataType:"primary",options:I.sys_job_status,onClick:()=>M(a)},null)},{label:"创建时间",prop:"createTime",visible:!0}],operation:{label:"操作",prop:"操作",width:"180",fixed:"right",visible:!0,render:({row:a})=>e("div",null,[e(r("el-button"),{type:"primary",size:"small"},{default:()=>[i("编辑")]}),e(r("el-button"),{type:"danger",size:"small"},{default:()=>[i("删除")]})])},loading:!1}),g=v({pageNum:1,pageSize:10,deptId:void 0}),L=()=>{g.pageNum=1;const a=P(g);m.value.getList(a)},S=a=>{g.deptId=a.id,L()},q=()=>{B().then(a=>{t.form={sex:"1"},t.userVisible=!0,t.title="添加用户",t.postOptions=a.posts,t.roleOptions=a.roles,t.form.password=t.initPassword,t.userVisible=!0})},m=h(),M=a=>{let o=a.status==="0"?"启用":"停用";w.confirm('确认要"'+o+'""'+a.userName+'"用户吗？').then(function(){const n={userId:a.userId,status:a.status};return me(n)}).then(()=>{_.success(o+"成功"),m.value.getList()}).catch(function(){})},z=async a=>{a&&(await a.validate(),t.form.userId!=null?fe(t.form).then(o=>{_.success("修改成功"),t.userVisible=!1,b()}):ce(t.form).then(o=>{_.success("新增成功"),t.userVisible=!1,b()}))},H=a=>{const o=a.userId;w.confirm('是否确认删除用户编号为"'+o+'"的数据项？').then(function(){return _e(o)}).then(()=>{b(),_.success("删除成功")}).catch(function(){})},K=a=>{const o=a.userId;B(o).then(n=>{t.title="修改用户",Object.assign(t.form,n.data),t.postOptions=n.posts,t.roleOptions=n.roles,t.form.password="",t.userVisible=!0})},A=a=>{console.log("row :>> ",a),w.prompt("请输入新的密码","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:o})=>{be({userId:a.userId,password:a.value}).then(n=>{_({type:"success",message:"更新成功"}),b()})}).catch(()=>{_({type:"info",message:"Input canceled"})})},E=(a,o)=>{switch(a){case"updatePwd":A(o);break;case"updaterole":Q(o);break}},Q=a=>{const o=a.userId;ue("/system/user-auth/role/"+o)},b=()=>{m.value.getList()},G=()=>{ie().then(a=>{t.deptOptions=a.data})};return O(()=>{ge("sys.user.initPassword").then(a=>{t.initPassword=a.msg}),b(),G()}),(a,o)=>{const n=r("el-button"),J=r("arrow-down"),W=r("el-icon"),C=r("el-dropdown-item"),X=r("el-dropdown-menu"),Y=r("el-dropdown"),Z=r("el-table-column"),ee=r("TableV2"),f=r("el-input"),u=r("el-form-item"),d=r("el-col"),te=r("el-cascader"),c=r("el-row"),N=r("el-option"),T=r("el-select"),le=r("el-form"),oe=r("el-dialog");return p(),x("div",ye,[k("div",we,[e(re,{style:{"margin-right":"10px"},onUpdateDept:S}),e(ee,{apiFunction:P(pe),class:"flex1",isInit:!1,filter:{...g},ref_key:"tableV2Ref",ref:m,columns:t.columnData},{tableHeader:l(()=>[k("div",ve,[e(n,{type:"primary",onClick:q},{default:l(()=>[i("添加用户")]),_:1})])]),operation:l(()=>[e(Z,{label:"操作",fixed:"right",width:"160px",align:"left"},{default:l(s=>[e(n,{type:"text",onClick:y=>K(s.row)},{default:l(()=>[i("修改")]),_:2},1032,["onClick"]),e(n,{type:"text",onClick:y=>H(s.row)},{default:l(()=>[i("删除")]),_:2},1032,["onClick"]),e(Y,{onCommand:y=>E(y,s.row)},{dropdown:l(()=>[e(X,null,{default:l(()=>[e(C,{command:"updatePwd"},{default:l(()=>[i("更换密码")]),_:1}),e(C,{command:"updaterole"},{default:l(()=>[i("分配角色")]),_:1})]),_:1})]),default:l(()=>[e(n,{class:"ml10",type:"text"},{default:l(()=>[i(" 更多 "),e(W,{class:"el-icon--right"},{default:l(()=>[e(J)]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["apiFunction","filter","columns"])]),e(oe,{modelValue:t.userVisible,"onUpdate:modelValue":o[13]||(o[13]=s=>t.userVisible=s),title:t.title,width:"50%","destroy-on-close":"",center:""},{footer:l(()=>[k("span",he,[e(n,{onClick:o[11]||(o[11]=s=>t.userVisible=!1)},{default:l(()=>[i("取消")]),_:1}),e(n,{type:"primary",onClick:o[12]||(o[12]=s=>z(U.value))},{default:l(()=>[i(" 确定 ")]),_:1})])]),default:l(()=>[e(le,{ref_key:"ruleFormRef",ref:U,model:t.form,rules:t.rules,"label-width":"120px",class:"demo-ruleForm"},{default:l(()=>[e(c,{gutter:20},{default:l(()=>[e(d,{span:12},{default:l(()=>[e(u,{label:"用户昵称",prop:"nickName"},{default:l(()=>[e(f,{modelValue:t.form.nickName,"onUpdate:modelValue":o[0]||(o[0]=s=>t.form.nickName=s)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(u,{label:"归属部门",prop:"deptId"},{default:l(()=>[e(te,{class:"w100",options:t.deptOptions,modelValue:t.form.deptId,"onUpdate:modelValue":o[1]||(o[1]=s=>t.form.deptId=s),props:{value:"id",emitPath:!1,checkStrictly:!0},clearable:""},null,8,["options","modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:20},{default:l(()=>[e(d,{span:12},{default:l(()=>[e(u,{label:"手机号码",prop:"phonenumber"},{default:l(()=>[e(f,{modelValue:t.form.phonenumber,"onUpdate:modelValue":o[2]||(o[2]=s=>t.form.phonenumber=s)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(u,{label:"邮箱",prop:"email"},{default:l(()=>[e(f,{modelValue:t.form.email,"onUpdate:modelValue":o[3]||(o[3]=s=>t.form.email=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:20},{default:l(()=>[e(d,{span:12},{default:l(()=>[t.form.userId==null?(p(),V(u,{key:0,label:"用户名称",prop:"userName"},{default:l(()=>[e(f,{modelValue:t.form.userName,"onUpdate:modelValue":o[4]||(o[4]=s=>t.form.userName=s)},null,8,["modelValue"])]),_:1})):j("",!0)]),_:1}),e(d,{span:12},{default:l(()=>[t.form.userId==null?(p(),V(u,{key:0,label:"用户密码",prop:"password"},{default:l(()=>[e(f,{modelValue:t.form.password,"onUpdate:modelValue":o[5]||(o[5]=s=>t.form.password=s),maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):j("",!0)]),_:1})]),_:1}),e(c,{gutter:20},{default:l(()=>[e(d,{span:12},{default:l(()=>[e(u,{label:"性别",prop:"sex"},{default:l(()=>[e(F,{class:"w100",dictCode:"sys_user_sex",modelValue:t.form.sex,"onUpdate:modelValue":o[6]||(o[6]=s=>t.form.sex=s)},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(u,{label:"状态"},{default:l(()=>[e(F,{class:"w100",dictCode:"sys_normal_disable",modelValue:t.form.status,"onUpdate:modelValue":o[7]||(o[7]=s=>t.form.status=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:20},{default:l(()=>[e(d,{span:12},{default:l(()=>[e(u,{label:"岗位"},{default:l(()=>[e(T,{class:"w100",modelValue:t.form.postIds,"onUpdate:modelValue":o[8]||(o[8]=s=>t.form.postIds=s),multiple:"",placeholder:"请选择岗位"},{default:l(()=>[(p(!0),x(D,null,R(t.postOptions,s=>(p(),V(N,{key:s.postId,label:s.postName,value:s.postId,disabled:s.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(u,{label:"角色"},{default:l(()=>[e(T,{class:"w100",modelValue:t.form.roleIds,"onUpdate:modelValue":o[9]||(o[9]=s=>t.form.roleIds=s),multiple:"",placeholder:"请选择角色"},{default:l(()=>[(p(!0),x(D,null,R(t.roleOptions,s=>(p(),V(N,{key:s.roleId,label:s.roleName,value:s.roleId,disabled:s.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(d,{span:24},{default:l(()=>[e(u,{label:"备注"},{default:l(()=>[e(f,{modelValue:t.form.remark,"onUpdate:modelValue":o[10]||(o[10]=s=>t.form.remark=s),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{dt as default};
