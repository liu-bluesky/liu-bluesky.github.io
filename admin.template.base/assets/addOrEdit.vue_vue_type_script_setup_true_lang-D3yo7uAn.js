import"./vue-BOAnm8BJ.js";import{d as F,e as J,g as P}from"./role-DwgGIMi0.js";import{e as U,p as q}from"./index-CxwxT6J_.js";import{t as j,r as z}from"./menu-BkCd7vts.js";import{u as L}from"./vue-i18n-CbYyLErm.js";import{a as V}from"./element-plus-DCyP7bP4.js";import{d as H,s as E,r as g,A as W,w as I,i as p,o as G,m as Q,k as s,a as k,j as r,q as i,u as X,n as A}from"./@vue-C7kBaxf_.js";const ae=H({__name:"addOrEdit",props:{modelValue:{type:Boolean,defalut:!1},id:{type:String,defalut:""}},emits:["update:modelValue","update"],setup(C,{emit:x}){const{t:v}=L(),h=x,c=E(!1),w=E(!1),N=g(),K=()=>{let t=u.value.getCheckedKeys(),e=u.value.getHalfCheckedKeys();return t.unshift.apply(t,e),t},O=async()=>{try{const t=await N.value.validate();a.value.model.menuIds=K(),d.id?F(t).then(e=>{V.success(v("操作成功")),f(),h("update")}):J(t).then(e=>{V.success(v("操作成功")),f(),h("update")})}catch(t){console.log("error :>> ",t)}},o=W({menuOptions:[],menuExpand:!1,menuNodeAll:!1}),a=g({rowAttrs:{gutter:20,justify:"start",align:"middle"},schema:[{label:"角色名称",prop:"roleName",colAttrs:{span:12},componentName:"ElInput",attrs:{placeholder:"请输入"},rules:[{required:!0,message:"不能为空",trigger:"change"}]},{label:"权限字符",prop:"roleKey",colAttrs:{span:12},componentName:"ElInput",attrs:{placeholder:"请选择"},rules:[{required:!1,message:"不能为空",trigger:"change"}]},{label:"角色顺序",prop:"roleSort",colAttrs:{span:12},componentName:"ElInputNumber",attrs:{placeholder:"请输入",precision:2,"controls-position":"right",...q}},{label:"邮箱",prop:"email",colAttrs:{span:12},componentName:"ElInput",attrs:{type:"number",placeholder:"请选择"}},{label:"用户名称",prop:"userName",colAttrs:{span:12},componentName:"ElInput",hidden:{matchPattern:"&&",dataSelect:[],type:"function",value:!1,dataJs:(t,e)=>e.userId!=null},attrs:{placeholder:"请输入"}},{label:"状态",prop:"status",colAttrs:{span:12},componentName:"selectDict",attrs:{dictCode:"sys_normal_disable",placeholder:"请选择",showPassword:!0}},{label:"菜单权限",prop:"menuIds",colAttrs:{span:12},componentName:"ElInput",attrs:{}},{label:"备注",type:"COMPONENT",formItemAttrs:{},attrs:{placeholder:"请输入",type:"textarea"},rules:[],prop:"remark",componentName:"ElInput",colAttrs:{span:24}}],model:{}});let d=C;const u=g(),R=()=>{j().then(t=>{o.menuOptions=t.data})},T=()=>{const t=M(d.id);P(d.id).then(e=>{a.value.model=e.data,A(()=>{t.then(n=>{n.checkedKeys.forEach(y=>{A(()=>{u.value.setChecked(y,!0,!1)})})})})})},M=t=>z(t).then(e=>(o.menuOptions=e.menus,e));I(()=>d.modelValue,t=>{c.value=t,d.id&&t?T():!d.id&&t&&(R(),a.value.model={})},{immediate:!0});const S=(t,e)=>{{let n=o.menuOptions;for(let m=0;m<n.length;m++)u.value.store.nodesMap[n[m].id].expanded=t}},_=(t,e)=>{u.value.setCheckedNodes(t?o.menuOptions:[])},B=(t,e)=>{a.value.model.menuCheckStrictly=!!t},f=()=>{h("update:modelValue",!1)};return I(()=>c.value,t=>{t||f()}),(t,e)=>{const n=p("el-checkbox"),m=p("el-tree"),y=p("ElementEasyForm"),b=p("el-button"),D=p("ComDialog");return G(),Q(D,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value=l),width:X(U),title:C.id?"编辑":"新增"},{footer:s(()=>[k("div",null,[r(b,{size:"large",onClick:f},{default:s(()=>e[10]||(e[10]=[i("取消")])),_:1}),r(b,{size:"large",loading:w.value,type:"primary",onClick:O},{default:s(()=>e[11]||(e[11]=[i("保存")])),_:1},8,["loading"])])]),default:s(()=>[r(y,{ref_key:"comFromRef",ref:N,formJson:a.value},{menuIds:s(()=>[k("div",null,[k("div",null,[r(n,{modelValue:o.menuExpand,"onUpdate:modelValue":e[0]||(e[0]=l=>o.menuExpand=l),onChange:e[1]||(e[1]=l=>S(l,"menu"))},{default:s(()=>e[7]||(e[7]=[i("展开/折叠")])),_:1},8,["modelValue"]),r(n,{modelValue:o.menuNodeAll,"onUpdate:modelValue":e[2]||(e[2]=l=>o.menuNodeAll=l),onChange:e[3]||(e[3]=l=>_(l,"menu"))},{default:s(()=>e[8]||(e[8]=[i("全选/全不选")])),_:1},8,["modelValue"]),r(n,{modelValue:a.value.model.menuCheckStrictly,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.model.menuCheckStrictly=l),onChange:e[5]||(e[5]=l=>B(l,"menu"))},{default:s(()=>e[9]||(e[9]=[i("父子联动")])),_:1},8,["modelValue"])]),r(m,{class:"tree-border",data:o.menuOptions,"show-checkbox":"",ref_key:"treeRef",ref:u,"node-key":"id","check-strictly":!a.value.model.menuCheckStrictly,"empty-text":"加载中，请稍候",props:o.defaultProps},null,8,["data","check-strictly","props"])])]),_:1},8,["formJson"])]),_:1},8,["modelValue","width","title"])}}});export{ae as _};
