var os=Object.freeze,Ra=Object.defineProperty;var f=(n,e)=>os(Ra(n,"raw",{value:os(e||n.slice())}));function A(n,e,t,s,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function o(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}let er=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return er=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};function $t(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const It=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch(e){}try{return new Error(JSON.stringify(n))}catch(e){}}return new Error(n)};class S extends Error{}class j extends S{constructor(e,t,s,r){super("".concat(j.makeMessage(e,t,s))),this.status=e,this.headers=r,this.requestID=r==null?void 0:r.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,s){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?"".concat(e," ").concat(r):e?"".concat(e," status code (no body)"):r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new ht({message:s,cause:It(t)});const a=t==null?void 0:t.error;return e===400?new tr(e,a,s,r):e===401?new sr(e,a,s,r):e===403?new nr(e,a,s,r):e===404?new rr(e,a,s,r):e===409?new ar(e,a,s,r):e===422?new ir(e,a,s,r):e===429?new or(e,a,s,r):e>=500?new cr(e,a,s,r):new j(e,a,s,r)}}class z extends j{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class ht extends j{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Dt extends ht{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}}class tr extends j{}class sr extends j{}class nr extends j{}class rr extends j{}class ar extends j{}class ir extends j{}class or extends j{}class cr extends j{}class lr extends S{constructor(){super("Could not parse response content as the length limit was reached")}}class ur extends S{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Se extends Error{constructor(e){super(e)}}const Ca=/^[a-z][a-z0-9+.-]*:/i,va=n=>Ca.test(n);let H=n=>(H=Array.isArray,H(n)),cs=H;function $a(n){return typeof n!="object"?{}:n!=null?n:{}}function Ia(n){if(!n)return!0;for(const e in n)return!1;return!0}function Ea(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function wt(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const ka=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new S("".concat(n," must be an integer"));if(e<0)throw new S("".concat(n," must be a positive integer"));return e},Oa=n=>{try{return JSON.parse(n)}catch(e){return}},Me=n=>new Promise(e=>setTimeout(e,n)),_e="5.8.2",Pa=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Ta(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Ma=()=>{var t,s,r,a,i;const n=Ta();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":us(Deno.build.os),"X-Stainless-Arch":ls(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(s=(t=Deno.version)==null?void 0:t.deno)!=null?s:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:".concat(EdgeRuntime),"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":us((r=globalThis.process.platform)!=null?r:"unknown"),"X-Stainless-Arch":ls((a=globalThis.process.arch)!=null?a:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!=null?i:"unknown"};const e=Na();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"browser:".concat(e.browser),"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Na(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const r=s[1]||0,a=s[2]||0,i=s[3]||0;return{browser:e,version:"".concat(r,".").concat(a,".").concat(i)}}}return null}const ls=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?"other:".concat(n):"unknown",us=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?"Other:".concat(n):"Unknown");let Be;const Fa=()=>Be!=null?Be:Be=Ma();function La(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function hr(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function dr(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return hr({start(){},async pull(t){const{done:s,value:r}=await e.next();s?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function fr(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Ba(n){var s,r;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((r=(s=n[Symbol.asyncIterator]()).return)==null?void 0:r.call(s));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const Wa=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),mr="RFC3986",pr=n=>String(n),hs={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:pr},Da="RFC1738";let Et=(n,e)=>{var t;return Et=(t=Object.hasOwn)!=null?t:Function.prototype.call.bind(Object.prototype.hasOwnProperty),Et(n,e)};const ee=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),yt=1024,Ua=(n,e,t,s,r)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});let i="";for(let c=0;c<a.length;c+=yt){const h=a.length>=yt?a.slice(c,c+yt):a,l=[];for(let p=0;p<h.length;++p){let u=h.charCodeAt(p);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||r===Da&&(u===40||u===41)){l[l.length]=h.charAt(p);continue}if(u<128){l[l.length]=ee[u];continue}if(u<2048){l[l.length]=ee[192|u>>6]+ee[128|u&63];continue}if(u<55296||u>=57344){l[l.length]=ee[224|u>>12]+ee[128|u>>6&63]+ee[128|u&63];continue}p+=1,u=65536+((u&1023)<<10|h.charCodeAt(p)&1023),l[l.length]=ee[240|u>>18]+ee[128|u>>12&63]+ee[128|u>>6&63]+ee[128|u&63]}i+=l.join("")}return i};function ja(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function ds(n,e){if(H(n)){const t=[];for(let s=0;s<n.length;s+=1)t.push(e(n[s]));return t}return e(n)}const _r={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},gr=function(n,e){Array.prototype.push.apply(n,H(e)?e:[e])};let We;const W={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ua,encodeValuesOnly:!1,format:mr,formatter:pr,indices:!1,serializeDate(n){return(We!=null?We:We=Function.prototype.call.bind(Date.prototype.toISOString))(n)},skipNulls:!1,strictNullHandling:!1};function qa(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const bt={};function wr(n,e,t,s,r,a,i,c,h,l,p,u,_,d,g,v,b,M){let x=n,N=M,k=0,y=!1;for(;(N=N.get(bt))!==void 0&&!y;){const $=N.get(n);if(k+=1,typeof $<"u"){if($===k)throw new RangeError("Cyclic object value");y=!0}typeof N.get(bt)>"u"&&(k=0)}if(typeof l=="function"?x=l(e,x):x instanceof Date?x=_==null?void 0:_(x):t==="comma"&&H(x)&&(x=ds(x,function($){return $ instanceof Date?_==null?void 0:_($):$})),x===null){if(a)return h&&!v?h(e,W.encoder,b,"key",d):e;x=""}if(qa(x)||ja(x)){if(h){const $=v?e:h(e,W.encoder,b,"key",d);return[(g==null?void 0:g($))+"="+(g==null?void 0:g(h(x,W.encoder,b,"value",d)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(x)))]}const F=[];if(typeof x>"u")return F;let P;if(t==="comma"&&H(x))v&&h&&(x=ds(x,h)),P=[{value:x.length>0?x.join(",")||null:void 0}];else if(H(l))P=l;else{const $=Object.keys(x);P=p?$.sort(p):$}const E=c?String(e).replace(/\./g,"%2E"):String(e),I=s&&H(x)&&x.length===1?E+"[]":E;if(r&&H(x)&&x.length===0)return I+"[]";for(let $=0;$<P.length;++$){const T=P[$],O=typeof T=="object"&&typeof T.value<"u"?T.value:x[T];if(i&&O===null)continue;const G=u&&c?T.replace(/\./g,"%2E"):T,ae=H(x)?typeof t=="function"?t(I,G):I:I+(u?"."+G:"["+G+"]");M.set(n,k);const X=new WeakMap;X.set(bt,M),gr(F,wr(O,ae,t,s,r,a,i,c,t==="comma"&&v&&H(x)?null:h,l,p,u,_,d,g,v,b,X))}return F}function Ja(n=W){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||W.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=mr;if(typeof n.format<"u"){if(!Et(hs,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const s=hs[t];let r=W.filter;(typeof n.filter=="function"||H(n.filter))&&(r=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in _r?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=W.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:W.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:W.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:W.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:W.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?W.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:W.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:W.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:W.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:W.encodeValuesOnly,filter:r,format:t,formatter:s,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:W.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:W.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:W.strictNullHandling}}function Ha(n,e={}){let t=n;const s=Ja(e);let r,a;typeof s.filter=="function"?(a=s.filter,t=a("",t)):H(s.filter)&&(a=s.filter,r=a);const i=[];if(typeof t!="object"||t===null)return"";const c=_r[s.arrayFormat],h=c==="comma"&&s.commaRoundTrip;r||(r=Object.keys(t)),s.sort&&r.sort(s.sort);const l=new WeakMap;for(let _=0;_<r.length;++_){const d=r[_];s.skipNulls&&t[d]===null||gr(i,wr(t[d],d,c,h,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}const p=i.join(s.delimiter);let u=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),p.length>0?u+p:""}function Xa(n){let e=0;for(const r of n)e+=r.length;const t=new Uint8Array(e);let s=0;for(const r of n)t.set(r,s),s+=r.length;return t}let De;function Ut(n){let e;return(De!=null?De:(e=new globalThis.TextEncoder,De=e.encode.bind(e)))(n)}let Ue;function fs(n){let e;return(Ue!=null?Ue:(e=new globalThis.TextDecoder,Ue=e.decode.bind(e)))(n)}var V,K;class dt{constructor(){V.set(this,void 0),K.set(this,void 0),A(this,V,new Uint8Array),A(this,K,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Ut(e):e;A(this,V,Xa([o(this,V,"f"),t]));const s=[];let r;for(;(r=Va(o(this,V,"f"),o(this,K,"f")))!=null;){if(r.carriage&&o(this,K,"f")==null){A(this,K,r.index);continue}if(o(this,K,"f")!=null&&(r.index!==o(this,K,"f")+1||r.carriage)){s.push(fs(o(this,V,"f").subarray(0,o(this,K,"f")-1))),A(this,V,o(this,V,"f").subarray(o(this,K,"f"))),A(this,K,null);continue}const a=o(this,K,"f")!==null?r.preceding-1:r.preceding,i=fs(o(this,V,"f").subarray(0,a));s.push(i),A(this,V,o(this,V,"f").subarray(r.index)),A(this,K,null)}return s}flush(){return o(this,V,"f").length?this.decode("\n"):[]}}V=new WeakMap,K=new WeakMap;dt.NEWLINE_CHARS=new Set(["\n","\r"]);dt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Va(n,e){for(let r=e!=null?e:0;r<n.length;r++){if(n[r]===10)return{preceding:r,index:r+1,carriage:!1};if(n[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Ka(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}class se{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*r(){if(s)throw new S("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const i of Qa(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let c;try{c=JSON.parse(i.data)}catch(h){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),h}if(c&&c.error)throw new j(void 0,c.error,void 0,e.headers);yield c}else{let c;try{c=JSON.parse(i.data)}catch(h){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),h}if(i.event=="error")throw new j(void 0,c.error,c.message,void 0);yield{event:i.event,data:c}}}a=!0}catch(i){if($t(i))return;throw i}finally{a||t.abort()}}return new se(r,t)}static fromReadableStream(e,t){let s=!1;async function*r(){const i=new dt,c=fr(e);for await(const h of c)for(const l of i.decode(h))yield l;for(const h of i.flush())yield h}async function*a(){if(s)throw new S("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let i=!1;try{for await(const c of r())i||c&&(yield JSON.parse(c));i=!0}catch(c){if($t(c))return;throw c}finally{i||t.abort()}}return new se(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=s.next();e.push(i),t.push(i)}return a.shift()}});return[new se(()=>r(e),this.controller),new se(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;return hr({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:r,done:a}=await t.next();if(a)return s.close();const i=Ut(JSON.stringify(r)+"\n");s.enqueue(i)}catch(r){s.error(r)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Qa(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new S("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new S("Attempted to iterate over a response with no body");const t=new za,s=new dt,r=fr(n.body);for await(const a of Ga(r))for(const i of s.decode(a)){const c=t.decode(i);c&&(yield c)}for(const a of s.flush()){const i=t.decode(a);i&&(yield i)}}async function*Ga(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Ut(t):t;let r=new Uint8Array(e.length+s.length);r.set(e),r.set(s,e.length),e=r;let a;for(;(a=Ka(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class za{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=Ya(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Ya(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const rt={off:0,error:200,warn:300,info:400,debug:500},ms=(n,e,t)=>{if(n){if(Ea(rt,n))return n;q(t).warn("".concat(e," was set to ").concat(JSON.stringify(n),", expected one of ").concat(JSON.stringify(Object.keys(rt))))}};function xe(){}function je(n,e,t){return!e||rt[n]>rt[t]?xe:e[n].bind(e)}const Za={error:xe,warn:xe,info:xe,debug:xe};let ps=new WeakMap;function q(n){var a;const e=n.logger,t=(a=n.logLevel)!=null?a:"off";if(!e)return Za;const s=ps.get(e);if(s&&s[0]===t)return s[1];const r={error:je("error",e,t),warn:je("warn",e,t),info:je("info",e,t),debug:je("debug",e,t)};return ps.set(e,[t,r]),r}const ce=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);async function yr(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:r,startTime:a}=e,i=await(async()=>{var u;if(e.options.stream)return q(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):se.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const c=t.headers.get("content-type"),h=(u=c==null?void 0:c.split(";")[0])==null?void 0:u.trim();if((h==null?void 0:h.includes("application/json"))||(h==null?void 0:h.endsWith("+json"))){const _=await t.json();return br(_,t)}return await t.text()})();return q(n).debug("[".concat(s,"] response parsed"),ce({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function br(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Ae;class ft extends Promise{constructor(e,t,s=yr){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=s,Ae.set(this,void 0),A(this,Ae,e)}_thenUnwrap(e){return new ft(o(this,Ae,"f"),this.responsePromise,async(t,s)=>br(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(o(this,Ae,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Ae=new WeakMap;var qe;class Sr{constructor(e,t,s,r){qe.set(this,void 0),A(this,qe,e),this.options=r,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new S("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await o(this,qe,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(qe=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ei extends ft{constructor(e,t,s){super(e,t,async(r,a)=>new s(r,a.response,await yr(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class mt extends Sr{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageRequestOptions(){return null}}class L extends Sr{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var s;const e=this.getPaginatedItems(),t=(s=e[e.length-1])==null?void 0:s.id;return t?{...this.options,query:{...$a(this.options.query),after:t}}:null}}const xr=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ke(n,e,t){return xr(),new File(n,e!=null?e:"unknown_file",t)}function Qe(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const Ar=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",de=async(n,e)=>({...n,body:await si(n.body,e)}),_s=new WeakMap;function ti(n){const e=typeof n=="function"?n:n.fetch,t=_s.get(e);if(t)return t;const s=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch(r){return!0}})();return _s.set(e,s),s}const si=async(n,e)=>{if(!await ti(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([s,r])=>kt(t,s,r))),t},ni=n=>n instanceof Blob&&"name"in n,kt=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError('Received null for "'.concat(e,"\"; to pass null in FormData, you must use the string 'null'"));if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,ke([await t.blob()],Qe(t)));else if(Ar(t))n.append(e,ke([await new Response(dr(t)).blob()],Qe(t)));else if(ni(t))n.append(e,t,Qe(t));else if(Array.isArray(t))await Promise.all(t.map(s=>kt(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,r])=>kt(n,"".concat(e,"[").concat(s,"]"),r)));else throw new TypeError("Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ".concat(t," instead"))}},Rr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",ri=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Rr(n),ai=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function ii(n,e,t){if(xr(),n=await n,ri(n))return n instanceof File?n:ke([await n.arrayBuffer()],n.name);if(ai(n)){const r=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),ke(await Ot(r),e,t)}const s=await Ot(n);if(e||(e=Qe(n)),!(t!=null&&t.type)){const r=s.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return ke(s,e,t)}async function Ot(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Rr(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(Ar(n))for await(const s of n)e.push(...await Ot(s));else{const s=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error("Unexpected data type: ".concat(typeof n).concat(s?"; constructor: ".concat(s):"").concat(oi(n)))}return e}function oi(n){if(typeof n!="object"||n===null)return"";const e=Object.getOwnPropertyNames(n);return"; props: [".concat(e.map(t=>'"'.concat(t,'"')).join(", "),"]")}class R{constructor(e){this._client=e}}function Cr(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ci=(n=Cr)=>function(t,...s){if(t.length===1)return t[0];let r=!1;const a=t.reduce((p,u,_)=>(/[?#]/.test(u)&&(r=!0),p+u+(_===s.length?"":(r?encodeURIComponent:n)(String(s[_])))),""),i=a.split(/[?#]/,1)[0],c=[],h=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let l;for(;(l=h.exec(i))!==null;)c.push({start:l.index,length:l[0].length});if(c.length>0){let p=0;const u=c.reduce((_,d)=>{const g=" ".repeat(d.start-p),v="^".repeat(d.length);return p=d.start+d.length,_+g+v},"");throw new S("Path parameters result in path with invalid segments:\n".concat(a,"\n").concat(u))}return a},m=ci(Cr);var ks;let vr=class extends R{list(e,t={},s){return this._client.getAPIList(m(ks||(ks=f(["/chat/completions/","/messages"])),e),L,{query:t,...s})}};function li(n){return typeof n.parse=="function"}const at=n=>(n==null?void 0:n.role)==="assistant",$r=n=>(n==null?void 0:n.role)==="tool";var Pt,Ge,ze,Re,Ce,Ye,ve,re,$e,it,ot,ge,Ir;class jt{constructor(){Pt.add(this),this.controller=new AbortController,Ge.set(this,void 0),ze.set(this,()=>{}),Re.set(this,()=>{}),Ce.set(this,void 0),Ye.set(this,()=>{}),ve.set(this,()=>{}),re.set(this,{}),$e.set(this,!1),it.set(this,!1),ot.set(this,!1),ge.set(this,!1),A(this,Ge,new Promise((e,t)=>{A(this,ze,e,"f"),A(this,Re,t,"f")})),A(this,Ce,new Promise((e,t)=>{A(this,Ye,e,"f"),A(this,ve,t,"f")})),o(this,Ge,"f").catch(()=>{}),o(this,Ce,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},o(this,Pt,"m",Ir).bind(this))},0)}_connected(){this.ended||(o(this,ze,"f").call(this),this._emit("connect"))}get ended(){return o(this,$e,"f")}get errored(){return o(this,it,"f")}get aborted(){return o(this,ot,"f")}abort(){this.controller.abort()}on(e,t){return(o(this,re,"f")[e]||(o(this,re,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=o(this,re,"f")[e];if(!s)return this;const r=s.findIndex(a=>a.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(o(this,re,"f")[e]||(o(this,re,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{A(this,ge,!0),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){A(this,ge,!0),await o(this,Ce,"f")}_emit(e,...t){if(o(this,$e,"f"))return;e==="end"&&(A(this,$e,!0),o(this,Ye,"f").call(this));const s=o(this,re,"f")[e];if(s&&(o(this,re,"f")[e]=s.filter(r=>!r.once),s.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!o(this,ge,"f")&&!(s!=null&&s.length)&&Promise.reject(r),o(this,Re,"f").call(this,r),o(this,ve,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!o(this,ge,"f")&&!(s!=null&&s.length)&&Promise.reject(r),o(this,Re,"f").call(this,r),o(this,ve,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Ge=new WeakMap,ze=new WeakMap,Re=new WeakMap,Ce=new WeakMap,Ye=new WeakMap,ve=new WeakMap,re=new WeakMap,$e=new WeakMap,it=new WeakMap,ot=new WeakMap,ge=new WeakMap,Pt=new WeakSet,Ir=function(e){if(A(this,it,!0),e instanceof Error&&e.name==="AbortError"&&(e=new z),e instanceof z)return A(this,ot,!0),this._emit("abort",e);if(e instanceof S)return this._emit("error",e);if(e instanceof Error){const t=new S(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new S(String(e)))};function qt(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Ne(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function ui(n,e){return!e||!Er(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Jt(n,e)}function Jt(n,e){const t=n.choices.map(s=>{var r,a;if(s.finish_reason==="length")throw new lr;if(s.finish_reason==="content_filter")throw new ur;return{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:(a=(r=s.message.tool_calls)==null?void 0:r.map(i=>di(e,i)))!=null?a:void 0}:void 0,parsed:s.message.content&&!s.message.refusal?hi(e,s.message.content):null}}});return{...n,choices:t}}function hi(n,e){var t,s;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((s=n.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function di(n,e){var s;const t=(s=n.tools)==null?void 0:s.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Ne(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function fi(n,e){var s;if(!n)return!1;const t=(s=n.tools)==null?void 0:s.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return Ne(t)||(t==null?void 0:t.function.strict)||!1}function Er(n){var e,t;return qt(n.response_format)?!0:(t=(e=n.tools)==null?void 0:e.some(s=>Ne(s)||s.type==="function"&&s.function.strict===!0))!=null?t:!1}function mi(n){for(const e of n!=null?n:[]){if(e.type!=="function")throw new S("Currently only `function` tool types support auto-parsing; Received `".concat(e.type,"`"));if(e.function.strict!==!0)throw new S("The `".concat(e.function.name,"` tool is not marked with `strict: true`. Only strict function tools can be auto-parsed"))}}var J,Tt,ct,Mt,Nt,Ft,kr,Or;const pi=10;class Pr extends jt{constructor(){super(...arguments),J.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(s=e.choices[0])==null?void 0:s.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),$r(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(at(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionToolCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new S("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),o(this,J,"m",Tt).call(this)}async finalMessage(){return await this.done(),o(this,J,"m",ct).call(this)}async finalFunctionToolCall(){return await this.done(),o(this,J,"m",Mt).call(this)}async finalFunctionToolCallResult(){return await this.done(),o(this,J,"m",Nt).call(this)}async totalUsage(){return await this.done(),o(this,J,"m",Ft).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=o(this,J,"m",ct).call(this);t&&this._emit("finalMessage",t);const s=o(this,J,"m",Tt).call(this);s&&this._emit("finalContent",s);const r=o(this,J,"m",Mt).call(this);r&&this._emit("finalFunctionToolCall",r);const a=o(this,J,"m",Nt).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",o(this,J,"m",Ft).call(this))}async _createChatCompletion(e,t,s){const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),o(this,J,"m",kr).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Jt(a,t))}async _runChatCompletion(e,t,s){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){var d,g,v;const r="tool",{tool_choice:a="auto",stream:i,...c}=t,h=typeof a!="string"&&((d=a==null?void 0:a.function)==null?void 0:d.name),{maxChatCompletions:l=pi}=s||{},p=t.tools.map(b=>{if(Ne(b)){if(!b.$callback)throw new S("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:b.$callback,name:b.function.name,description:b.function.description||"",parameters:b.function.parameters,parse:b.$parseRaw,strict:!0}}}return b}),u={};for(const b of p)b.type==="function"&&(u[b.function.name||b.function.function.name]=b.function);const _="tools"in t?p.map(b=>b.type==="function"?{type:"function",function:{name:b.function.name||b.function.function.name,parameters:b.function.parameters,description:b.function.description,strict:b.function.strict}}:b):void 0;for(const b of t.messages)this._addMessage(b,!1);for(let b=0;b<l;++b){const x=(g=(await this._createChatCompletion(e,{...c,tool_choice:a,tools:_,messages:[...this.messages]},s)).choices[0])==null?void 0:g.message;if(!x)throw new S("missing message in ChatCompletion response");if(!((v=x.tool_calls)!=null&&v.length))return;for(const N of x.tool_calls){if(N.type!=="function")continue;const k=N.id,{name:y,arguments:F}=N.function,P=u[y];if(P){if(h&&h!==y){const T="Invalid tool_call: ".concat(JSON.stringify(y),". ").concat(JSON.stringify(h)," requested. Please try again");this._addMessage({role:r,tool_call_id:k,content:T});continue}}else{const T="Invalid tool_call: ".concat(JSON.stringify(y),". Available options are: ").concat(Object.keys(u).map(O=>JSON.stringify(O)).join(", "),". Please try again");this._addMessage({role:r,tool_call_id:k,content:T});continue}let E;try{E=li(P)?await P.parse(F):F}catch(T){const O=T instanceof Error?T.message:String(T);this._addMessage({role:r,tool_call_id:k,content:O});continue}const I=await P.function(E,this),$=o(this,J,"m",Or).call(this,I);if(this._addMessage({role:r,tool_call_id:k,content:$}),h)return}}}}J=new WeakSet,Tt=function(){var e;return(e=o(this,J,"m",ct).call(this).content)!=null?e:null},ct=function(){var t,s;let e=this.messages.length;for(;e-- >0;){const r=this.messages[e];if(at(r))return{...r,content:(t=r.content)!=null?t:null,refusal:(s=r.refusal)!=null?s:null}}throw new S("stream ended without producing a ChatCompletionMessage with role=assistant")},Mt=function(){var e,t;for(let s=this.messages.length-1;s>=0;s--){const r=this.messages[s];if(at(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},Nt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if($r(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(s=>{var r;return s.role==="assistant"&&((r=s.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Ft=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},kr=function(e){if(e.n!=null&&e.n>1)throw new S("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Or=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ht extends Pr{static runTools(e,t,s){const r=new Ht,a={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),at(e)&&e.content&&this._emit("content",e.content)}}const Tr=1,Mr=2,Nr=4,Fr=8,Lr=16,Br=32,Wr=64,Dr=128,Ur=256,jr=Dr|Ur,qr=Lr|Br|jr|Wr,Jr=Tr|Mr|qr,Hr=Nr|Fr,_i=Jr|Hr,D={STR:Tr,NUM:Mr,ARR:Nr,OBJ:Fr,NULL:Lr,BOOL:Br,NAN:Wr,INFINITY:Dr,MINUS_INFINITY:Ur,INF:jr,SPECIAL:qr,ATOM:Jr,COLLECTION:Hr,ALL:_i};class gi extends Error{}class wi extends Error{}function yi(n,e=D.ALL){if(typeof n!="string")throw new TypeError("expecting str, got ".concat(typeof n));if(!n.trim())throw new Error("".concat(n," is empty"));return bi(n.trim(),e)}const bi=(n,e)=>{const t=n.length;let s=0;const r=_=>{throw new gi("".concat(_," at position ").concat(s))},a=_=>{throw new wi("".concat(_," at position ").concat(s))},i=()=>(u(),s>=t&&r("Unexpected end of input"),n[s]==='"'?c():n[s]==="{"?h():n[s]==="["?l():n.substring(s,s+4)==="null"||D.NULL&e&&t-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):n.substring(s,s+4)==="true"||D.BOOL&e&&t-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):n.substring(s,s+5)==="false"||D.BOOL&e&&t-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):n.substring(s,s+8)==="Infinity"||D.INFINITY&e&&t-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):n.substring(s,s+9)==="-Infinity"||D.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):n.substring(s,s+3)==="NaN"||D.NAN&e&&t-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):p()),c=()=>{const _=s;let d=!1;for(s++;s<t&&(n[s]!=='"'||d&&n[s-1]==="\\");)d=n[s]==="\\"?!d:!1,s++;if(n.charAt(s)=='"')try{return JSON.parse(n.substring(_,++s-Number(d)))}catch(g){a(String(g))}else if(D.STR&e)try{return JSON.parse(n.substring(_,s-Number(d))+'"')}catch(g){return JSON.parse(n.substring(_,n.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},h=()=>{s++,u();const _={};try{for(;n[s]!=="}";){if(u(),s>=t&&D.OBJ&e)return _;const d=c();u(),s++;try{const g=i();Object.defineProperty(_,d,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(D.OBJ&e)return _;throw g}u(),n[s]===","&&s++}}catch(d){if(D.OBJ&e)return _;r("Expected '}' at end of object")}return s++,_},l=()=>{s++;const _=[];try{for(;n[s]!=="]";)_.push(i()),u(),n[s]===","&&s++}catch(d){if(D.ARR&e)return _;r("Expected ']' at end of array")}return s++,_},p=()=>{if(s===0){n==="-"&&D.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(n)}catch(d){if(D.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch(g){}a(String(d))}}const _=s;for(n[s]==="-"&&s++;n[s]&&!",]}".includes(n[s]);)s++;s==t&&!(D.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(n.substring(_,s))}catch(d){n.substring(_,s)==="-"&&D.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(n.substring(_,n.lastIndexOf("e")))}catch(g){a(String(g))}}},u=()=>{for(;s<t&&" \n\r	".includes(n[s]);)s++};return i()},gs=n=>yi(n,D.ALL^D.NUM);var B,ne,fe,ie,St,Je,xt,At,Rt,He,Ct,ws;class Te extends Pr{constructor(e){super(),B.add(this),ne.set(this,void 0),fe.set(this,void 0),ie.set(this,void 0),A(this,ne,e),A(this,fe,[])}get currentChatCompletionSnapshot(){return o(this,ie,"f")}static fromReadableStream(e){const t=new Te(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){const r=new Te(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){var i;super._createChatCompletion;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),o(this,B,"m",St).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const c of a)o(this,B,"m",xt).call(this,c);if((i=a.controller.signal)!=null&&i.aborted)throw new z;return this._addChatCompletion(o(this,B,"m",He).call(this))}async _fromReadableStream(e,t){var i;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),o(this,B,"m",St).call(this),this._connected();const r=se.fromReadableStream(e,this.controller);let a;for await(const c of r)a&&a!==c.id&&this._addChatCompletion(o(this,B,"m",He).call(this)),o(this,B,"m",xt).call(this,c),a=c.id;if((i=r.controller.signal)!=null&&i.aborted)throw new z;return this._addChatCompletion(o(this,B,"m",He).call(this))}[(ne=new WeakMap,fe=new WeakMap,ie=new WeakMap,B=new WeakSet,St=function(){this.ended||A(this,ie,void 0)},Je=function(t){let s=o(this,fe,"f")[t.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},o(this,fe,"f")[t.index]=s,s)},xt=function(t){var r,a,i,c,h,l,p,u,_,d,g,v,b,M,x,N,k,y,F,P;if(this.ended)return;const s=o(this,B,"m",ws).call(this,t);this._emit("chunk",t,s);for(const E of t.choices){const I=s.choices[E.index];E.delta.content!=null&&((r=I.message)==null?void 0:r.role)==="assistant"&&((a=I.message)!=null&&a.content)&&(this._emit("content",E.delta.content,I.message.content),this._emit("content.delta",{delta:E.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),E.delta.refusal!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((c=I.message)!=null&&c.refusal)&&this._emit("refusal.delta",{delta:E.delta.refusal,snapshot:I.message.refusal}),((h=E.logprobs)==null?void 0:h.content)!=null&&((l=I.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(p=E.logprobs)==null?void 0:p.content,snapshot:(_=(u=I.logprobs)==null?void 0:u.content)!=null?_:[]}),((d=E.logprobs)==null?void 0:d.refusal)!=null&&((g=I.message)==null?void 0:g.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(v=E.logprobs)==null?void 0:v.refusal,snapshot:(M=(b=I.logprobs)==null?void 0:b.refusal)!=null?M:[]});const $=o(this,B,"m",Je).call(this,I);I.finish_reason&&(o(this,B,"m",Rt).call(this,I),$.current_tool_call_index!=null&&o(this,B,"m",At).call(this,I,$.current_tool_call_index));for(const T of(x=E.delta.tool_calls)!=null?x:[])$.current_tool_call_index!==T.index&&(o(this,B,"m",Rt).call(this,I),$.current_tool_call_index!=null&&o(this,B,"m",At).call(this,I,$.current_tool_call_index)),$.current_tool_call_index=T.index;for(const T of(N=E.delta.tool_calls)!=null?N:[]){const O=(k=I.message.tool_calls)==null?void 0:k[T.index];O!=null&&O.type&&((O==null?void 0:O.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(y=O.function)==null?void 0:y.name,index:T.index,arguments:O.function.arguments,parsed_arguments:O.function.parsed_arguments,arguments_delta:(P=(F=T.function)==null?void 0:F.arguments)!=null?P:""}):(O==null||O.type,void 0))}}},At=function(t,s){var i,c,h;if(o(this,B,"m",Je).call(this,t).done_tool_calls.has(s))return;const a=(i=t.message.tool_calls)==null?void 0:i[s];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const l=(h=(c=o(this,ne,"f"))==null?void 0:c.tools)==null?void 0:h.find(p=>p.type==="function"&&p.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:s,arguments:a.function.arguments,parsed_arguments:Ne(l)?l.$parseRaw(a.function.arguments):l!=null&&l.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Rt=function(t){var r,a;const s=o(this,B,"m",Je).call(this,t);if(t.message.content&&!s.content_done){s.content_done=!0;const i=o(this,B,"m",Ct).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},He=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");const t=o(this,ie,"f");if(!t)throw new S("request ended without sending any chunks");return A(this,ie,void 0),A(this,fe,[]),Si(t,o(this,ne,"f"))},Ct=function(){var s;const t=(s=o(this,ne,"f"))==null?void 0:s.response_format;return qt(t)?t:null},ws=function(t){var p,u,_,d,g,v;var s,r,a,i;let c=o(this,ie,"f");const{choices:h,...l}=t;c?Object.assign(c,l):c=A(this,ie,{...l,choices:[]});for(const{delta:b,finish_reason:M,index:x,logprobs:N=null,...k}of t.choices){let y=c.choices[x];if(y||(y=c.choices[x]={finish_reason:M,index:x,message:{},logprobs:N,...k}),N)if(!y.logprobs)y.logprobs=Object.assign({},N);else{const{content:O,refusal:G,...ae}=N;Object.assign(y.logprobs,ae),O&&((p=(s=y.logprobs).content)!=null||(s.content=[]),y.logprobs.content.push(...O)),G&&((u=(r=y.logprobs).refusal)!=null||(r.refusal=[]),y.logprobs.refusal.push(...G))}if(M&&(y.finish_reason=M,o(this,ne,"f")&&Er(o(this,ne,"f")))){if(M==="length")throw new lr;if(M==="content_filter")throw new ur}if(Object.assign(y,k),!b)continue;const{content:F,refusal:P,function_call:E,role:I,tool_calls:$,...T}=b;if(Object.assign(y.message,T),P&&(y.message.refusal=(y.message.refusal||"")+P),I&&(y.message.role=I),E&&(y.message.function_call?(E.name&&(y.message.function_call.name=E.name),E.arguments&&((_=(a=y.message.function_call).arguments)!=null||(a.arguments=""),y.message.function_call.arguments+=E.arguments)):y.message.function_call=E),F&&(y.message.content=(y.message.content||"")+F,!y.message.refusal&&o(this,B,"m",Ct).call(this)&&(y.message.parsed=gs(y.message.content))),$){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:O,id:G,type:ae,function:X,...Aa}of $){const Z=(d=(i=y.message.tool_calls)[O])!=null?d:i[O]={};Object.assign(Z,Aa),G&&(Z.id=G),ae&&(Z.type=ae),X&&((v=Z.function)!=null||(Z.function={name:(g=X.name)!=null?g:"",arguments:""})),X!=null&&X.name&&(Z.function.name=X.name),X!=null&&X.arguments&&(Z.function.arguments+=X.arguments,fi(o(this,ne,"f"),Z)&&(Z.function.parsed_arguments=gs(Z.function.arguments)))}}}return c},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new se(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Si(n,e){const{id:t,choices:s,created:r,model:a,system_fingerprint:i,...c}=n,h={...c,id:t,choices:s.map(({message:l,finish_reason:p,index:u,logprobs:_,...d})=>{var N,k,y;if(!p)throw new S("missing finish_reason for choice ".concat(u));const{content:g=null,function_call:v,tool_calls:b,...M}=l,x=l.role;if(!x)throw new S("missing role for choice ".concat(u));if(v){const{arguments:F,name:P}=v;if(F==null)throw new S("missing function_call.arguments for choice ".concat(u));if(!P)throw new S("missing function_call.name for choice ".concat(u));return{...d,message:{content:g,function_call:{arguments:F,name:P},role:x,refusal:(N=l.refusal)!=null?N:null},finish_reason:p,index:u,logprobs:_}}return b?{...d,index:u,finish_reason:p,logprobs:_,message:{...M,role:x,content:g,refusal:(k=l.refusal)!=null?k:null,tool_calls:b.map((F,P)=>{const{function:E,type:I,id:$,...T}=F,{arguments:O,name:G,...ae}=E||{};if($==null)throw new S("missing choices[".concat(u,"].tool_calls[").concat(P,"].id\n").concat(Xe(n)));if(I==null)throw new S("missing choices[".concat(u,"].tool_calls[").concat(P,"].type\n").concat(Xe(n)));if(G==null)throw new S("missing choices[".concat(u,"].tool_calls[").concat(P,"].function.name\n").concat(Xe(n)));if(O==null)throw new S("missing choices[".concat(u,"].tool_calls[").concat(P,"].function.arguments\n").concat(Xe(n)));return{...T,id:$,type:I,function:{...ae,name:G,arguments:O}}})}}:{...d,message:{...M,content:g,role:x,refusal:(y=l.refusal)!=null?y:null},finish_reason:p,index:u,logprobs:_}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return ui(h,e)}function Xe(n){return JSON.stringify(n)}class lt extends Te{static fromReadableStream(e){const t=new lt(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){const r=new lt(t),a={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}var Os,Ps,Ts;let Xt=class extends R{constructor(){super(...arguments),this.messages=new vr(this._client)}create(e,t){var s;return this._client.post("/chat/completions",{body:e,...t,stream:(s=e.stream)!=null?s:!1})}retrieve(e,t){return this._client.get(m(Os||(Os=f(["/chat/completions/",""])),e),t)}update(e,t,s){return this._client.post(m(Ps||(Ps=f(["/chat/completions/",""])),e),{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",L,{query:e,...t})}delete(e,t){return this._client.delete(m(Ts||(Ts=f(["/chat/completions/",""])),e),t)}parse(e,t){return mi(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(s=>Jt(s,e))}runTools(e,t){return e.stream?lt.runTools(this._client,e,t):Ht.runTools(this._client,e,t)}stream(e,t){return Te.createChatCompletion(this._client,e,t)}};Xt.Messages=vr;class Vt extends R{constructor(){super(...arguments),this.completions=new Xt(this._client)}}Vt.Completions=Xt;const Xr=Symbol("brand.privateNullableHeaders");function*xi(n){if(!n)return;if(Xr in n){const{values:s,nulls:r}=n;yield*s.entries();for(const a of r)yield[a,null];return}let e=!1,t;n instanceof Headers?t=n.entries():cs(n)?t=n:(e=!0,t=Object.entries(n!=null?n:{}));for(let s of t){const r=s[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=cs(s[1])?s[1]:[s[1]];let i=!1;for(const c of a)c!==void 0&&(e&&!i&&(i=!0,yield[r,null]),yield[r,c])}}const w=n=>{const e=new Headers,t=new Set;for(const s of n){const r=new Set;for(const[a,i]of xi(s)){const c=a.toLowerCase();r.has(c)||(e.delete(a),r.add(c)),i===null?(e.delete(a),t.add(c)):(e.append(a,i),t.delete(c))}}return{[Xr]:!0,values:e,nulls:t}};class Vr extends R{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:w([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class Kr extends R{create(e,t){var s;return this._client.post("/audio/transcriptions",de({body:e,...t,stream:(s=e.stream)!=null?s:!1,__metadata:{model:e.model}},this._client))}}class Qr extends R{create(e,t){return this._client.post("/audio/translations",de({body:e,...t,__metadata:{model:e.model}},this._client))}}class Fe extends R{constructor(){super(...arguments),this.transcriptions=new Kr(this._client),this.translations=new Qr(this._client),this.speech=new Vr(this._client)}}Fe.Transcriptions=Kr;Fe.Translations=Qr;Fe.Speech=Vr;var Ms,Ns;class Gr extends R{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(m(Ms||(Ms=f(["/batches/",""])),e),t)}list(e={},t){return this._client.getAPIList("/batches",L,{query:e,...t})}cancel(e,t){return this._client.post(m(Ns||(Ns=f(["/batches/","/cancel"])),e),t)}}var Fs,Ls,Bs;class zr extends R{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(m(Fs||(Fs=f(["/assistants/",""])),e),{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,s){return this._client.post(m(Ls||(Ls=f(["/assistants/",""])),e),{body:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e={},t){return this._client.getAPIList("/assistants",L,{query:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(m(Bs||(Bs=f(["/assistants/",""])),e),{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Yr extends R{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Zr extends R{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class pt extends R{constructor(){super(...arguments),this.sessions=new Yr(this._client),this.transcriptionSessions=new Zr(this._client)}}pt.Sessions=Yr;pt.TranscriptionSessions=Zr;var Ws,Ds,Us,js,qs;class ea extends R{create(e,t,s){return this._client.post(m(Ws||(Ws=f(["/threads/","/messages"])),e),{body:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}retrieve(e,t,s){const{thread_id:r}=t;return this._client.get(m(Ds||(Ds=f(["/threads/","/messages/",""])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}update(e,t,s){const{thread_id:r,...a}=t;return this._client.post(m(Us||(Us=f(["/threads/","/messages/",""])),r,e),{body:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(m(js||(js=f(["/threads/","/messages"])),e),L,{query:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}delete(e,t,s){const{thread_id:r}=t;return this._client.delete(m(qs||(qs=f(["/threads/","/messages/",""])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}var Js,Hs;class ta extends R{retrieve(e,t,s){const{thread_id:r,run_id:a,...i}=t;return this._client.get(m(Js||(Js=f(["/threads/","/runs/","/steps/",""])),r,a,e),{query:i,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t,s){const{thread_id:r,...a}=t;return this._client.getAPIList(m(Hs||(Hs=f(["/threads/","/runs/","/steps"])),r,e),L,{query:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}const Ai=n=>{if(typeof Buffer<"u"){const e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,s=new Uint8Array(t);for(let r=0;r<t;r++)s[r]=e.charCodeAt(r);return Array.from(new Float32Array(s.buffer))}};var vt={};const me=n=>{var e,t,s,r,a;if(typeof globalThis.process<"u")return(t=(e=vt==null?void 0:vt[n])==null?void 0:e.trim())!=null?t:void 0;if(typeof globalThis.Deno<"u")return(a=(r=(s=globalThis.Deno.env)==null?void 0:s.get)==null?void 0:r.call(s,n))==null?void 0:a.trim()};var U,ue,Lt,te,Ze,Y,he,ye,le,ut,Q,et,tt,Oe,Ie,Ee,ys,bs,Ss,xs,As,Rs,Cs;class Pe extends jt{constructor(){super(...arguments),U.add(this),Lt.set(this,[]),te.set(this,{}),Ze.set(this,{}),Y.set(this,void 0),he.set(this,void 0),ye.set(this,void 0),le.set(this,void 0),ut.set(this,void 0),Q.set(this,void 0),et.set(this,void 0),tt.set(this,void 0),Oe.set(this,void 0)}[(Lt=new WeakMap,te=new WeakMap,Ze=new WeakMap,Y=new WeakMap,he=new WeakMap,ye=new WeakMap,le=new WeakMap,ut=new WeakMap,Q=new WeakMap,et=new WeakMap,tt=new WeakMap,Oe=new WeakMap,U=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ue;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=se.fromReadableStream(e,this.controller);for await(const i of r)o(this,U,"m",Ie).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new z;return this._addRun(o(this,U,"m",Ee).call(this))}toReadableStream(){return new se(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r){const a=new ue;return a._run(()=>a._runToolAssistantStream(e,t,s,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,s,r){var h;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...s,stream:!0},c=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of c)o(this,U,"m",Ie).call(this,l);if((h=c.controller.signal)!=null&&h.aborted)throw new z;return this._addRun(o(this,U,"m",Ee).call(this))}static createThreadAssistantStream(e,t,s){const r=new ue;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){const a=new ue;return a._run(()=>a._runAssistantStream(e,t,s,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return o(this,et,"f")}currentRun(){return o(this,tt,"f")}currentMessageSnapshot(){return o(this,Y,"f")}currentRunStepSnapshot(){return o(this,Oe,"f")}async finalRunSteps(){return await this.done(),Object.values(o(this,te,"f"))}async finalMessages(){return await this.done(),Object.values(o(this,Ze,"f"))}async finalRun(){if(await this.done(),!o(this,he,"f"))throw Error("Final run was not received.");return o(this,he,"f")}async _createThreadAssistantStream(e,t,s){var c;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...s,signal:this.controller.signal});this._connected();for await(const h of i)o(this,U,"m",Ie).call(this,h);if((c=i.controller.signal)!=null&&c.aborted)throw new z;return this._addRun(o(this,U,"m",Ee).call(this))}async _createAssistantStream(e,t,s,r){var h;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...s,stream:!0},c=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of c)o(this,U,"m",Ie).call(this,l);if((h=c.controller.signal)!=null&&h.aborted)throw new z;return this._addRun(o(this,U,"m",Ee).call(this))}static accumulateDelta(e,t){for(const[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let a=e[s];if(a==null){e[s]=r;continue}if(s==="index"||s==="type"){e[s]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(wt(a)&&wt(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(const i of r){if(!wt(i))throw new Error("Expected array delta entry to be an object but got: ".concat(i));const c=i.index;if(c==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof c!="number")throw new Error("Expected array delta entry `index` property to be a number but got ".concat(c));const h=a[c];h==null?a.push(i):a[c]=this.accumulateDelta(h,i)}continue}else throw Error("Unhandled record type: ".concat(s,", deltaValue: ").concat(r,", accValue: ").concat(a));e[s]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r){return await this._createToolAssistantStream(t,e,s,r)}}ue=Pe,Ie=function(e){if(!this.ended)switch(A(this,et,e),o(this,U,"m",Ss).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":o(this,U,"m",Cs).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":o(this,U,"m",bs).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":o(this,U,"m",ys).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ee=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");if(!o(this,he,"f"))throw Error("Final run has not been received");return o(this,he,"f")},ys=function(e){const[t,s]=o(this,U,"m",As).call(this,e,o(this,Y,"f"));A(this,Y,t),o(this,Ze,"f")[t.id]=t;for(const r of s){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=o(this,ye,"f")){if(o(this,le,"f"))switch(o(this,le,"f").type){case"text":this._emit("textDone",o(this,le,"f").text,o(this,Y,"f"));break;case"image_file":this._emit("imageFileDone",o(this,le,"f").image_file,o(this,Y,"f"));break}A(this,ye,r.index)}A(this,le,t.content[r.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(o(this,ye,"f")!==void 0){const r=e.data.content[o(this,ye,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,o(this,Y,"f"));break;case"text":this._emit("textDone",r.text,o(this,Y,"f"));break}}o(this,Y,"f")&&this._emit("messageDone",e.data),A(this,Y,void 0)}},bs=function(e){const t=o(this,U,"m",xs).call(this,e);switch(A(this,Oe,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of s.step_details.tool_calls)a.index==o(this,ut,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(o(this,Q,"f")&&this._emit("toolCallDone",o(this,Q,"f")),A(this,ut,a.index),A(this,Q,t.step_details.tool_calls[a.index]),o(this,Q,"f")&&this._emit("toolCallCreated",o(this,Q,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":A(this,Oe,void 0),e.data.step_details.type=="tool_calls"&&o(this,Q,"f")&&(this._emit("toolCallDone",o(this,Q,"f")),A(this,Q,void 0)),this._emit("runStepDone",e.data,t);break}},Ss=function(e){o(this,Lt,"f").push(e),this._emit("event",e)},xs=function(e){switch(e.event){case"thread.run.step.created":return o(this,te,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=o(this,te,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const r=ue.accumulateDelta(t,s.delta);o(this,te,"f")[e.data.id]=r}return o(this,te,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":o(this,te,"f")[e.data.id]=e.data;break}if(o(this,te,"f")[e.data.id])return o(this,te,"f")[e.data.id];throw new Error("No snapshot available")},As=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=o(this,U,"m",Rs).call(this,a,i)}else t.content[a.index]=a,s.push(a);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Rs=function(e,t){return ue.accumulateDelta(t,e)},Cs=function(e){switch(A(this,tt,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":A(this,he,e.data),o(this,Q,"f")&&(this._emit("toolCallDone",o(this,Q,"f")),A(this,Q,void 0));break}};var Xs,Vs,Ks,Qs,Gs,zs;let Kt=class extends R{constructor(){super(...arguments),this.steps=new ta(this._client)}create(e,t,s){var i;const{include:r,...a}=t;return this._client.post(m(Xs||(Xs=f(["/threads/","/runs"])),e),{query:{include:r},body:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers]),stream:(i=t.stream)!=null?i:!1})}retrieve(e,t,s){const{thread_id:r}=t;return this._client.get(m(Vs||(Vs=f(["/threads/","/runs/",""])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}update(e,t,s){const{thread_id:r,...a}=t;return this._client.post(m(Ks||(Ks=f(["/threads/","/runs/",""])),r,e),{body:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(m(Qs||(Qs=f(["/threads/","/runs"])),e),L,{query:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}cancel(e,t,s){const{thread_id:r}=t;return this._client.post(m(Gs||(Gs=f(["/threads/","/runs/","/cancel"])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(r.id,{thread_id:e},s)}createAndStream(e,t,s){return Pe.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){var a,i;const r=w([s==null?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":(i=(a=s==null?void 0:s.pollIntervalMs)==null?void 0:a.toString())!=null?i:void 0}]);for(;;){const{data:c,response:h}=await this.retrieve(e,t,{...s,headers:{...s==null?void 0:s.headers,...r}}).withResponse();switch(c.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(s!=null&&s.pollIntervalMs)l=s.pollIntervalMs;else{const p=h.headers.get("openai-poll-after-ms");if(p){const u=parseInt(p);isNaN(u)||(l=u)}}await Me(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return c}}}stream(e,t,s){return Pe.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){var i;const{thread_id:r,...a}=t;return this._client.post(m(zs||(zs=f(["/threads/","/runs/","/submit_tool_outputs"])),r,e),{body:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers]),stream:(i=t.stream)!=null?i:!1})}async submitToolOutputsAndPoll(e,t,s){const r=await this.submitToolOutputs(e,t,s);return await this.poll(r.id,t,s)}submitToolOutputsStream(e,t,s){return Pe.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}};Kt.Steps=ta;var Ys,Zs,en;class _t extends R{constructor(){super(...arguments),this.runs=new Kt(this._client),this.messages=new ea(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(m(Ys||(Ys=f(["/threads/",""])),e),{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,s){return this._client.post(m(Zs||(Zs=f(["/threads/",""])),e),{body:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}delete(e,t){return this._client.delete(m(en||(en=f(["/threads/",""])),e),{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){var s;return this._client.post("/threads/runs",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:(s=e.stream)!=null?s:!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return Pe.createThreadAssistantStream(e,this._client.beta.threads,t)}}_t.Runs=Kt;_t.Messages=ea;class Le extends R{constructor(){super(...arguments),this.realtime=new pt(this._client),this.assistants=new zr(this._client),this.threads=new _t(this._client)}}Le.Realtime=pt;Le.Assistants=zr;Le.Threads=_t;class sa extends R{create(e,t){var s;return this._client.post("/completions",{body:e,...t,stream:(s=e.stream)!=null?s:!1})}}var tn;class na extends R{retrieve(e,t,s){const{container_id:r}=t;return this._client.get(m(tn||(tn=f(["/containers/","/files/","/content"])),r,e),{...s,headers:w([{Accept:"application/binary"},s==null?void 0:s.headers]),__binaryResponse:!0})}}var sn,nn,rn,an;let Qt=class extends R{constructor(){super(...arguments),this.content=new na(this._client)}create(e,t,s){return this._client.post(m(sn||(sn=f(["/containers/","/files"])),e),de({body:t,...s},this._client))}retrieve(e,t,s){const{container_id:r}=t;return this._client.get(m(nn||(nn=f(["/containers/","/files/",""])),r,e),s)}list(e,t={},s){return this._client.getAPIList(m(rn||(rn=f(["/containers/","/files"])),e),L,{query:t,...s})}delete(e,t,s){const{container_id:r}=t;return this._client.delete(m(an||(an=f(["/containers/","/files/",""])),r,e),{...s,headers:w([{Accept:"*/*"},s==null?void 0:s.headers])})}};Qt.Content=na;var on,cn;class Gt extends R{constructor(){super(...arguments),this.files=new Qt(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(m(on||(on=f(["/containers/",""])),e),t)}list(e={},t){return this._client.getAPIList("/containers",L,{query:e,...t})}delete(e,t){return this._client.delete(m(cn||(cn=f(["/containers/",""])),e),{...t,headers:w([{Accept:"*/*"},t==null?void 0:t.headers])})}}Gt.Files=Qt;class ra extends R{create(e,t){const s=!!e.encoding_format;let r=s?e.encoding_format:"base64";s&&q(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return s?a:(q(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(c=>{const h=c.embedding;c.embedding=Ai(h)}),i)))}}var ln,un;class aa extends R{retrieve(e,t,s){const{eval_id:r,run_id:a}=t;return this._client.get(m(ln||(ln=f(["/evals/","/runs/","/output_items/",""])),r,a,e),s)}list(e,t,s){const{eval_id:r,...a}=t;return this._client.getAPIList(m(un||(un=f(["/evals/","/runs/","/output_items"])),r,e),L,{query:a,...s})}}var hn,dn,fn,mn,pn;class zt extends R{constructor(){super(...arguments),this.outputItems=new aa(this._client)}create(e,t,s){return this._client.post(m(hn||(hn=f(["/evals/","/runs"])),e),{body:t,...s})}retrieve(e,t,s){const{eval_id:r}=t;return this._client.get(m(dn||(dn=f(["/evals/","/runs/",""])),r,e),s)}list(e,t={},s){return this._client.getAPIList(m(fn||(fn=f(["/evals/","/runs"])),e),L,{query:t,...s})}delete(e,t,s){const{eval_id:r}=t;return this._client.delete(m(mn||(mn=f(["/evals/","/runs/",""])),r,e),s)}cancel(e,t,s){const{eval_id:r}=t;return this._client.post(m(pn||(pn=f(["/evals/","/runs/",""])),r,e),s)}}zt.OutputItems=aa;var _n,gn,wn;class Yt extends R{constructor(){super(...arguments),this.runs=new zt(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(m(_n||(_n=f(["/evals/",""])),e),t)}update(e,t,s){return this._client.post(m(gn||(gn=f(["/evals/",""])),e),{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",L,{query:e,...t})}delete(e,t){return this._client.delete(m(wn||(wn=f(["/evals/",""])),e),t)}}Yt.Runs=zt;var yn,bn,Sn;let ia=class extends R{create(e,t){return this._client.post("/files",de({body:e,...t},this._client))}retrieve(e,t){return this._client.get(m(yn||(yn=f(["/files/",""])),e),t)}list(e={},t){return this._client.getAPIList("/files",L,{query:e,...t})}delete(e,t){return this._client.delete(m(bn||(bn=f(["/files/",""])),e),t)}content(e,t){return this._client.get(m(Sn||(Sn=f(["/files/","/content"])),e),{...t,headers:w([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await Me(t),i=await this.retrieve(e),Date.now()-a>s)throw new Dt({message:"Giving up on waiting for file ".concat(e," to finish processing after ").concat(s," milliseconds.")});return i}};class oa extends R{}let ca=class extends R{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Zt extends R{constructor(){super(...arguments),this.graders=new ca(this._client)}}Zt.Graders=ca;var xn,An,Rn;class la extends R{create(e,t,s){return this._client.getAPIList(m(xn||(xn=f(["/fine_tuning/checkpoints/","/permissions"])),e),mt,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(m(An||(An=f(["/fine_tuning/checkpoints/","/permissions"])),e),{query:t,...s})}delete(e,t,s){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(m(Rn||(Rn=f(["/fine_tuning/checkpoints/","/permissions/",""])),r,e),s)}}let es=class extends R{constructor(){super(...arguments),this.permissions=new la(this._client)}};es.Permissions=la;var Cn;class ua extends R{list(e,t={},s){return this._client.getAPIList(m(Cn||(Cn=f(["/fine_tuning/jobs/","/checkpoints"])),e),L,{query:t,...s})}}var vn,$n,In,En,kn;class ts extends R{constructor(){super(...arguments),this.checkpoints=new ua(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(m(vn||(vn=f(["/fine_tuning/jobs/",""])),e),t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",L,{query:e,...t})}cancel(e,t){return this._client.post(m($n||($n=f(["/fine_tuning/jobs/","/cancel"])),e),t)}listEvents(e,t={},s){return this._client.getAPIList(m(In||(In=f(["/fine_tuning/jobs/","/events"])),e),L,{query:t,...s})}pause(e,t){return this._client.post(m(En||(En=f(["/fine_tuning/jobs/","/pause"])),e),t)}resume(e,t){return this._client.post(m(kn||(kn=f(["/fine_tuning/jobs/","/resume"])),e),t)}}ts.Checkpoints=ua;class be extends R{constructor(){super(...arguments),this.methods=new oa(this._client),this.jobs=new ts(this._client),this.checkpoints=new es(this._client),this.alpha=new Zt(this._client)}}be.Methods=oa;be.Jobs=ts;be.Checkpoints=es;be.Alpha=Zt;class ha extends R{}class ss extends R{constructor(){super(...arguments),this.graderModels=new ha(this._client)}}ss.GraderModels=ha;class da extends R{createVariation(e,t){return this._client.post("/images/variations",de({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",de({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}var On,Pn;class fa extends R{retrieve(e,t){return this._client.get(m(On||(On=f(["/models/",""])),e),t)}list(e){return this._client.getAPIList("/models",mt,e)}delete(e,t){return this._client.delete(m(Pn||(Pn=f(["/models/",""])),e),t)}}class ma extends R{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function Ri(n,e){return!e||!vi(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(s=>({...s,parsed:null}))}:t)}:pa(n,e)}function pa(n,e){const t=n.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:Ei(e,r)};if(r.type==="message"){const a=r.content.map(i=>i.type==="output_text"?{...i,parsed:Ci(e,i.text)}:i);return{...r,content:a}}return r}),s=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||Bt(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const r of s.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),s}function Ci(n,e){var t,s,r,a;return((s=(t=n.text)==null?void 0:t.format)==null?void 0:s.type)!=="json_schema"?null:"$parseRaw"in((r=n.text)==null?void 0:r.format)?((a=n.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function vi(n){var e;return!!qt((e=n.text)==null?void 0:e.format)}function $i(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Ii(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function Ei(n,e){var s;const t=Ii((s=n.tools)!=null?s:[],e.name);return{...e,...e,parsed_arguments:$i(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Bt(n){const e=[];for(const t of n.output)if(t.type==="message")for(const s of t.content)s.type==="output_text"&&e.push(s.text);n.output_text=e.join("")}var pe,Ve,oe,Ke,vs,$s,Is,Es;class ns extends jt{constructor(e){super(),pe.add(this),Ve.set(this,void 0),oe.set(this,void 0),Ke.set(this,void 0),A(this,Ve,e)}static createResponse(e,t,s){const r=new ns(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,s){var c,h;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),o(this,pe,"m",vs).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=(c=t.starting_after)!=null?c:null):a=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const l of a)o(this,pe,"m",$s).call(this,l,i);if((h=a.controller.signal)!=null&&h.aborted)throw new z;return o(this,pe,"m",Is).call(this)}[(Ve=new WeakMap,oe=new WeakMap,Ke=new WeakMap,pe=new WeakSet,vs=function(){this.ended||A(this,oe,void 0)},$s=function(t,s){if(this.ended)return;const r=(i,c)=>{(s==null||c.sequence_number>s)&&this._emit(i,c)},a=o(this,pe,"m",Es).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const i=a.output[t.output_index];if(!i)throw new S("missing output at index ".concat(t.output_index));if(i.type==="message"){const c=i.content[t.content_index];if(!c)throw new S("missing content at index ".concat(t.content_index));if(c.type!=="output_text")throw new S("expected content to be 'output_text', got ".concat(c.type));r("response.output_text.delta",{...t,snapshot:c.text})}break}case"response.function_call_arguments.delta":{const i=a.output[t.output_index];if(!i)throw new S("missing output at index ".concat(t.output_index));i.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:r(t.type,t);break}},Is=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");const t=o(this,oe,"f");if(!t)throw new S("request ended without sending any events");A(this,oe,void 0);const s=ki(t,o(this,Ve,"f"));return A(this,Ke,s),s},Es=function(t){let s=o(this,oe,"f");if(!s){if(t.type!=="response.created")throw new S("When snapshot hasn't been set yet, expected 'response.created' event, got ".concat(t.type));return s=A(this,oe,t.response),s}switch(t.type){case"response.output_item.added":{s.output.push(t.item);break}case"response.content_part.added":{const r=s.output[t.output_index];if(!r)throw new S("missing output at index ".concat(t.output_index));r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{const r=s.output[t.output_index];if(!r)throw new S("missing output at index ".concat(t.output_index));if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new S("missing content at index ".concat(t.content_index));if(a.type!=="output_text")throw new S("expected content to be 'output_text', got ".concat(a.type));a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=s.output[t.output_index];if(!r)throw new S("missing output at index ".concat(t.output_index));r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{A(this,oe,t.response);break}}return s},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=o(this,Ke,"f");if(!e)throw new S("stream ended without producing a ChatCompletion");return e}}function ki(n,e){return Ri(n,e)}var Tn;class _a extends R{list(e,t={},s){return this._client.getAPIList(m(Tn||(Tn=f(["/responses/","/input_items"])),e),L,{query:t,...s})}}var Mn,Nn,Fn;class rs extends R{constructor(){super(...arguments),this.inputItems=new _a(this._client)}create(e,t){var s;return this._client.post("/responses",{body:e,...t,stream:(s=e.stream)!=null?s:!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Bt(r),r))}retrieve(e,t={},s){var r;return this._client.get(m(Mn||(Mn=f(["/responses/",""])),e),{query:t,...s,stream:(r=t==null?void 0:t.stream)!=null?r:!1})._thenUnwrap(a=>("object"in a&&a.object==="response"&&Bt(a),a))}delete(e,t){return this._client.delete(m(Nn||(Nn=f(["/responses/",""])),e),{...t,headers:w([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(s=>pa(s,e))}stream(e,t){return ns.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(m(Fn||(Fn=f(["/responses/","/cancel"])),e),t)}}rs.InputItems=_a;var Ln;class ga extends R{create(e,t,s){return this._client.post(m(Ln||(Ln=f(["/uploads/","/parts"])),e),de({body:t,...s},this._client))}}var Bn,Wn;class as extends R{constructor(){super(...arguments),this.parts=new ga(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(m(Bn||(Bn=f(["/uploads/","/cancel"])),e),t)}complete(e,t,s){return this._client.post(m(Wn||(Wn=f(["/uploads/","/complete"])),e),{body:t,...s})}}as.Parts=ga;const Oi=async n=>{const e=await Promise.allSettled(n),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error("".concat(t.length," promise(s) failed - see the above errors"))}const s=[];for(const r of e)r.status==="fulfilled"&&s.push(r.value);return s};var Dn,Un,jn,qn;class wa extends R{create(e,t,s){return this._client.post(m(Dn||(Dn=f(["/vector_stores/","/file_batches"])),e),{body:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}retrieve(e,t,s){const{vector_store_id:r}=t;return this._client.get(m(Un||(Un=f(["/vector_stores/","/file_batches/",""])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}cancel(e,t,s){const{vector_store_id:r}=t;return this._client.post(m(jn||(jn=f(["/vector_stores/","/file_batches/","/cancel"])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s){const{vector_store_id:r,...a}=t;return this._client.getAPIList(m(qn||(qn=f(["/vector_stores/","/file_batches/","/files"])),r,e),L,{query:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async poll(e,t,s){var a,i;const r=w([s==null?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":(i=(a=s==null?void 0:s.pollIntervalMs)==null?void 0:a.toString())!=null?i:void 0}]);for(;;){const{data:c,response:h}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(c.status){case"in_progress":let l=5e3;if(s!=null&&s.pollIntervalMs)l=s.pollIntervalMs;else{const p=h.headers.get("openai-poll-after-ms");if(p){const u=parseInt(p);isNaN(u)||(l=u)}}await Me(l);break;case"failed":case"cancelled":case"completed":return c}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){var _;if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(_=r==null?void 0:r.maxConcurrency)!=null?_:5,i=Math.min(a,t.length),c=this._client,h=t.values(),l=[...s];async function p(d){for(let g of d){const v=await c.files.create({file:g,purpose:"assistants"},r);l.push(v.id)}}const u=Array(i).fill(h).map(p);return await Oi(u),await this.createAndPoll(e,{file_ids:l})}}var Jn,Hn,Xn,Vn,Kn,Qn;class ya extends R{create(e,t,s){return this._client.post(m(Jn||(Jn=f(["/vector_stores/","/files"])),e),{body:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}retrieve(e,t,s){const{vector_store_id:r}=t;return this._client.get(m(Hn||(Hn=f(["/vector_stores/","/files/",""])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}update(e,t,s){const{vector_store_id:r,...a}=t;return this._client.post(m(Xn||(Xn=f(["/vector_stores/","/files/",""])),r,e),{body:a,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(m(Vn||(Vn=f(["/vector_stores/","/files"])),e),L,{query:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}delete(e,t,s){const{vector_store_id:r}=t;return this._client.delete(m(Kn||(Kn=f(["/vector_stores/","/files/",""])),r,e),{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){var a,i;const r=w([s==null?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":(i=(a=s==null?void 0:s.pollIntervalMs)==null?void 0:a.toString())!=null?i:void 0}]);for(;;){const c=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse(),h=c.data;switch(h.status){case"in_progress":let l=5e3;if(s!=null&&s.pollIntervalMs)l=s.pollIntervalMs;else{const p=c.response.headers.get("openai-poll-after-ms");if(p){const u=parseInt(p);isNaN(u)||(l=u)}}await Me(l);break;case"failed":case"completed":return h}}}async upload(e,t,s){const r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){const r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){const{vector_store_id:r}=t;return this._client.getAPIList(m(Qn||(Qn=f(["/vector_stores/","/files/","/content"])),r,e),mt,{...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}var Gn,zn,Yn,Zn;class gt extends R{constructor(){super(...arguments),this.files=new ya(this._client),this.fileBatches=new wa(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(m(Gn||(Gn=f(["/vector_stores/",""])),e),{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,s){return this._client.post(m(zn||(zn=f(["/vector_stores/",""])),e),{body:t,...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",L,{query:e,...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(m(Yn||(Yn=f(["/vector_stores/",""])),e),{...t,headers:w([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,s){return this._client.getAPIList(m(Zn||(Zn=f(["/vector_stores/","/search"])),e),mt,{body:t,method:"post",...s,headers:w([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}gt.Files=ya;gt.FileBatches=wa;var we,ba,st;class Sa extends R{constructor(){super(...arguments),we.add(this)}async unwrap(e,t,s=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,s,r),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,r=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");o(this,we,"m",ba).call(this,s);const a=w([t]).values,i=o(this,we,"m",st).call(this,a,"webhook-signature"),c=o(this,we,"m",st).call(this,a,"webhook-timestamp"),h=o(this,we,"m",st).call(this,a,"webhook-id"),l=parseInt(c,10);if(isNaN(l))throw new Se("Invalid webhook timestamp format");const p=Math.floor(Date.now()/1e3);if(p-l>r)throw new Se("Webhook timestamp is too old");if(l>p+r)throw new Se("Webhook timestamp is too new");const u=i.split(" ").map(v=>v.startsWith("v1,")?v.substring(3):v),_=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=h?"".concat(h,".").concat(c,".").concat(e):"".concat(c,".").concat(e),g=await crypto.subtle.importKey("raw",_,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const v of u)try{const b=Buffer.from(v,"base64");if(await crypto.subtle.verify("HMAC",g,b,new TextEncoder().encode(d)))return}catch(b){continue}throw new Se("The given webhook signature does not match the expected signature")}}we=new WeakSet,ba=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},st=function(e,t){if(!e)throw new Error("Headers are required");const s=e.get(t);if(s==null)throw new Error("Missing required header: ".concat(t));return s};var Wt,is,nt,xa;class C{constructor({baseURL:e=me("OPENAI_BASE_URL"),apiKey:t=me("OPENAI_API_KEY"),organization:s=(c=>(c=me("OPENAI_ORG_ID"))!=null?c:null)(),project:r=(h=>(h=me("OPENAI_PROJECT_ID"))!=null?h:null)(),webhookSecret:a=(l=>(l=me("OPENAI_WEBHOOK_SECRET"))!=null?l:null)(),...i}={}){var _,d,g,v,b,M;if(Wt.add(this),nt.set(this,void 0),this.completions=new sa(this),this.chat=new Vt(this),this.embeddings=new ra(this),this.files=new ia(this),this.images=new da(this),this.audio=new Fe(this),this.moderations=new ma(this),this.models=new fa(this),this.fineTuning=new be(this),this.graders=new ss(this),this.vectorStores=new gt(this),this.webhooks=new Sa(this),this.beta=new Le(this),this.batches=new Gr(this),this.uploads=new as(this),this.responses=new rs(this),this.evals=new Yt(this),this.containers=new Gt(this),t===void 0)throw new S("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const p={apiKey:t,organization:s,project:r,webhookSecret:a,...i,baseURL:e||"https://api.openai.com/v1"};if(!p.dangerouslyAllowBrowser&&Pa())throw new S("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=p.baseURL,this.timeout=(_=p.timeout)!=null?_:is.DEFAULT_TIMEOUT,this.logger=(d=p.logger)!=null?d:console;const u="warn";this.logLevel=u,this.logLevel=(v=(g=ms(p.logLevel,"ClientOptions.logLevel",this))!=null?g:ms(me("OPENAI_LOG"),"process.env['OPENAI_LOG']",this))!=null?v:u,this.fetchOptions=p.fetchOptions,this.maxRetries=(b=p.maxRetries)!=null?b:2,this.fetch=(M=p.fetch)!=null?M:La(),A(this,nt,Wa),this._options=p,this.apiKey=t,this.organization=s,this.project=r,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return w([{Authorization:"Bearer ".concat(this.apiKey)}])}stringifyQuery(e){return Ha(e,{arrayFormat:"brackets"})}getUserAgent(){return"".concat(this.constructor.name,"/JS ").concat(_e)}defaultIdempotencyKey(){return"stainless-node-retry-".concat(er())}makeStatusError(e,t,s,r){return j.generate(e,t,s,r)}buildURL(e,t,s){const r=!o(this,Wt,"m",xa).call(this)&&s||this.baseURL,a=va(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Ia(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new ft(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var M,x,N;const r=await e,a=(M=r.maxRetries)!=null?M:this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:i,url:c,timeout:h}=this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(i,{url:c,options:r});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=s===void 0?"":", retryOf: ".concat(s),u=Date.now();if(q(this).debug("[".concat(l,"] sending request"),ce({retryOfRequestLogID:s,method:r.method,url:c,options:r,headers:i.headers})),(x=r.signal)!=null&&x.aborted)throw new z;const _=new AbortController,d=await this.fetchWithTimeout(c,i,h,_).catch(It),g=Date.now();if(d instanceof Error){const k="retrying, ".concat(t," attempts remaining");if((N=r.signal)!=null&&N.aborted)throw new z;const y=$t(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return q(this).info("[".concat(l,"] connection ").concat(y?"timed out":"failed"," - ").concat(k)),q(this).debug("[".concat(l,"] connection ").concat(y?"timed out":"failed"," (").concat(k,")"),ce({retryOfRequestLogID:s,url:c,durationMs:g-u,message:d.message})),this.retryRequest(r,t,s!=null?s:l);throw q(this).info("[".concat(l,"] connection ").concat(y?"timed out":"failed"," - error; no more retries left")),q(this).debug("[".concat(l,"] connection ").concat(y?"timed out":"failed"," (error; no more retries left)"),ce({retryOfRequestLogID:s,url:c,durationMs:g-u,message:d.message})),y?new Dt:new ht({cause:d})}const v=[...d.headers.entries()].filter(([k])=>k==="x-request-id").map(([k,y])=>", "+k+": "+JSON.stringify(y)).join(""),b="[".concat(l).concat(p).concat(v,"] ").concat(i.method," ").concat(c," ").concat(d.ok?"succeeded":"failed"," with status ").concat(d.status," in ").concat(g-u,"ms");if(!d.ok){const k=this.shouldRetry(d);if(t&&k){const $="retrying, ".concat(t," attempts remaining");return await Ba(d.body),q(this).info("".concat(b," - ").concat($)),q(this).debug("[".concat(l,"] response error (").concat($,")"),ce({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:g-u})),this.retryRequest(r,t,s!=null?s:l,d.headers)}const y=k?"error; no more retries left":"error; not retryable";q(this).info("".concat(b," - ").concat(y));const F=await d.text().catch($=>It($).message),P=Oa(F),E=P?void 0:F;throw q(this).debug("[".concat(l,"] response error (").concat(y,")"),ce({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:E,durationMs:Date.now()-u})),this.makeStatusError(d.status,P,E,d.headers)}return q(this).info(b),q(this).debug("[".concat(l,"] response start"),ce({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:g-u})),{response:d,options:r,controller:_,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new ei(this,s,e)}async fetchWithTimeout(e,t,s,r){const{signal:a,method:i,...c}=t||{};a&&a.addEventListener("abort",()=>r.abort());const h=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,p={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...c};i&&(p.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(h)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,r){var h;let a;const i=r==null?void 0:r.get("retry-after-ms");if(i){const l=parseFloat(i);Number.isNaN(l)||(a=l)}const c=r==null?void 0:r.get("retry-after");if(c&&!a){const l=parseFloat(c);Number.isNaN(l)?a=Date.parse(c)-Date.now():a=l*1e3}if(!(a&&0<=a&&a<60*1e3)){const l=(h=e.maxRetries)!=null?h:this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,l)}return await Me(a),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),c=1-Math.random()*.25;return i*c*1e3}buildRequest(e,{retryCount:t=0}={}){var d,g,v;const s={...e},{method:r,path:a,query:i,defaultBaseURL:c}=s,h=this.buildURL(a,i,c);"timeout"in s&&ka("timeout",s.timeout),s.timeout=(d=s.timeout)!=null?d:this.timeout;const{bodyHeaders:l,body:p}=this.buildBody({options:s}),u=this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"},...p&&{body:p},...(g=this.fetchOptions)!=null?g:{},...(v=s.fetchOptions)!=null?v:{}},url:h,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=w([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Fa(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=w([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:dr(e)}:o(this,nt,"f").call(this,{body:e,headers:s})}}is=C,nt=new WeakMap,Wt=new WeakSet,xa=function(){return this.baseURL!=="https://api.openai.com/v1"};C.OpenAI=is;C.DEFAULT_TIMEOUT=6e5;C.OpenAIError=S;C.APIError=j;C.APIConnectionError=ht;C.APIConnectionTimeoutError=Dt;C.APIUserAbortError=z;C.NotFoundError=rr;C.ConflictError=ar;C.RateLimitError=or;C.BadRequestError=tr;C.AuthenticationError=sr;C.InternalServerError=cr;C.PermissionDeniedError=nr;C.UnprocessableEntityError=ir;C.InvalidWebhookSignatureError=Se;C.toFile=ii;C.Completions=sa;C.Chat=Vt;C.Embeddings=ra;C.Files=ia;C.Images=da;C.Audio=Fe;C.Moderations=ma;C.Models=fa;C.FineTuning=be;C.Graders=ss;C.VectorStores=gt;C.Webhooks=Sa;C.Beta=Le;C.Batches=Gr;C.Uploads=as;C.Responses=rs;C.Evals=Yt;C.Containers=Gt;export{C as O};
