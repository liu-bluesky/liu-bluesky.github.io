import"./vue-BCJY8gBf.js";import{u as pe,b as ie}from"./vue-router-Bk-12vT2.js";import{g as fe,i as ce,r as be,a as _e}from"./index-DnKBT612.js";import{D as ye}from"./index-DMBomKMH.js";import{f as Ve,l as ke,h as ge,d as ve,e as Ce,i as Se,g as xe,j as he}from"./role-DQhvBjKq.js";import we from"./addOrEdit-BajgY_ll.js";import{t as De}from"./menu-CI36NPAS.js";import{c as E,a as g}from"./element-plus-BIk4sW6s.js";import{d as Ue,s as F,B as M,b as j,k as t,r as v,j as r,o as x,c as B,l as a,a as p,v as s,u as Ne,y as Re,F as Ke,m as Te,q as Ae,Q as Ie,R as Oe,n as Ee}from"./@vue-BwKUEgJD.js";import"./axios-DWt2DAqT.js";import"./pinia-TB7j859w.js";import"./vue-demi-DP18qiWf.js";import"./@vueuse-BO9Bf6Jf.js";import"./js-cookie-C1NIBS1L.js";import"./vue-i18n-DkRB_xiH.js";import"./@intlify-BnZ-SFqO.js";/* empty css                    */import"./dayjs-CpORZXld.js";import"./element-easy-print-DsNlMTPy.js";import"./mockjs-CpzBLoCE.js";import"./lodash-Ce2coQ-v.js";import"./vue3-draggable-resizable-yn-CG0QmAMT.js";import"./element-easy-form-CUlqWkgt.js";import"./vuedraggable-BjUjsGh2.js";import"./@vue-monaco-B0CNy8YX.js";import"./uuid-CQkTLCs1.js";import"./@element-plus-D9bzjPyL.js";import"./lodash-es-D0ldFxdg.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-riLredlm.js";import"./async-validator-BxgltDpX.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-uXSQws5g.js";const Fe={class:"commonBoxmp"},Me={class:"jcb aic w100"},je={class:"aic"},Be={class:"aic"},Le={class:"dialog-footer"},Pe={class:"dialog-footer"},$e=Ue({__name:"index",setup(qe){pe(),ie();const C=F(""),{parseTime:He,addDateRange:Qe,getDict:L}=ce(),V=F(!1);let h=M({sys_job_status:[]});j(async()=>{h.sys_job_status=await L("sys_job_status")});const l=M({openDataScope:!1,defaultProps:{children:"children",label:"label"},menuOptions:[],deptOptions:[],dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],deptExpand:!1,deptNodeAll:!1,menuExpand:!1,menuNodeAll:!1,title:"",form:{},userVisible:!1,rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]},dateRange:[],height:0,tableData:[],columnData:[{label:"角色编号",prop:"roleId",visible:!0},{label:"角色名称",prop:"roleName",visible:!0},{label:"权限字符",prop:"roleKey",visible:!0},{label:"显示顺序",prop:"roleSort",visible:!0},{label:"状态",prop:"status",visible:!0,render:({row:n})=>t(ye,{values:n.status,dataType:"primary",options:h.sys_job_status,onClick:()=>ee(n)},null)},{label:"创建时间",prop:"createTime",visible:!0}],loading:!1}),P=()=>{let n=b.value.getCheckedKeys(),e=b.value.getHalfCheckedKeys();return n.unshift.apply(n,e),n},$=()=>{let n=_.value.getCheckedKeys(),e=_.value.getHalfCheckedKeys();return n.unshift.apply(n,e),n},q=n=>{l.form.roleId!=null&&(l.form.deptIds=$(),ge(l.form).then(e=>{l.openDataScope=!1,i()}))},H=async n=>{n&&(await n.validate(),l.form.menuIds=P(),l.form.roleId!=null?ve(l.form).then(e=>{g.success("修改成功"),l.userVisible=!1,i()}):Ce(l.form).then(e=>{g.success("新增成功"),l.userVisible=!1,i()}))},Q=n=>{const e=n.roleId;E.confirm('是否确认删除角色编号为"'+e+'"的数据项？').then(function(){return Se(e)}).then(()=>{g.success("删除成功"),i()}).catch(function(){})},z=n=>{C.value=n.roleId,V.value=!0},G=()=>{C.value="",Y(),V.value=!0},w=v(),i=()=>{w.value.getList()},D=v(),b=v(),_=v(),J=n=>{l.form={};const e=Z(n.roleId);xe(n.roleId).then(d=>{l.form=d.data,l.openDataScope=!0,Ee(()=>{e.then(u=>{_.value.setCheckedKeys(u.checkedKeys)})}),l.title="分配数据权限"})},W=n=>{const e=n.roleId;be("/system/role-auth/user/"+e)},X=(n,e)=>{switch(n){case"handleDataScope":J(e);break;case"handleAuthUser":W(e);break}},Y=()=>{De().then(n=>{l.menuOptions=n.data})},Z=n=>he(n).then(e=>(l.deptOptions=e.depts,e)),ee=n=>{let e=n.status==="0"?"启用":"停用";E.confirm('确认要"'+e+'""'+n.roleName+'"角色吗？').then(function(){return Ve(n.roleId,n.status)}).then(()=>{g.success(e+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})},U=(n,e)=>{if(e=="menu"){let d=l.menuOptions;for(let u=0;u<d.length;u++)b.value.store.nodesMap[d[u].id].expanded=n}else if(e=="dept"){let d=l.deptOptions;for(let u=0;u<d.length;u++)_.value.store.nodesMap[d[u].id].expanded=n}},N=(n,e)=>{e=="menu"?b.value.setCheckedNodes(n?l.menuOptions:[]):e=="dept"&&_.value.setCheckedNodes(n?l.deptOptions:[])},R=(n,e)=>{e=="menu"?l.form.menuCheckStrictly=!!n:e=="dept"&&(l.form.deptCheckStrictly=!!n)};return j(()=>{i()}),(n,e)=>{const d=r("el-button"),u=r("el-link"),le=r("arrow-down"),K=r("el-icon"),T=r("el-dropdown-item"),te=r("el-dropdown-menu"),oe=r("el-dropdown"),ae=r("el-table-column"),ne=r("TableV2"),y=r("el-input"),m=r("el-form-item"),f=r("el-col"),re=r("QuestionFilled"),se=r("el-tooltip"),k=r("el-row"),de=r("el-input-number"),c=r("el-checkbox"),A=r("el-tree"),I=r("el-form"),O=r("el-dialog"),ue=r("el-option"),me=r("el-select");return x(),B("div",Fe,[t(ne,{class:"flex1",apiFunction:Ne(ke),isInit:!1,filter:{},ref_key:"tableV2Ref",ref:w,columns:l.columnData},{tableHeader:a(()=>[p("div",Me,[t(d,{type:"primary",onClick:G},{default:a(()=>e[26]||(e[26]=[s("添加角色")])),_:1})])]),operation:a(()=>[t(ae,{label:"操作",fixed:"right",width:"160px",align:"left"},{default:a(o=>[p("div",je,[t(u,{type:"primary",onClick:S=>z(o.row)},{default:a(()=>e[27]||(e[27]=[s("修改")])),_:2},1032,["onClick"]),t(u,{type:"primary",class:"mx5",onClick:S=>Q(o.row)},{default:a(()=>e[28]||(e[28]=[s("删除")])),_:2},1032,["onClick"]),t(oe,{onCommand:S=>X(S,o.row)},{dropdown:a(()=>[t(te,null,{default:a(()=>[t(T,{command:"handleDataScope"},{default:a(()=>e[30]||(e[30]=[s("数据权限")])),_:1}),t(T,{command:"handleAuthUser"},{default:a(()=>e[31]||(e[31]=[s("分配用户")])),_:1})]),_:1})]),default:a(()=>[t(u,{class:"ml10",type:"primary"},{default:a(()=>[e[29]||(e[29]=s(" 更多 ")),t(K,{class:"el-icon--right"},{default:a(()=>[t(le)]),_:1})]),_:1})]),_:2},1032,["onCommand"])])]),_:1})]),_:1},8,["apiFunction","columns"]),t(O,{modelValue:l.userVisible,"onUpdate:modelValue":e[13]||(e[13]=o=>l.userVisible=o),title:l.title,width:"50%","destroy-on-close":"",center:""},{footer:a(()=>[p("span",Le,[t(d,{onClick:e[11]||(e[11]=o=>l.userVisible=!1)},{default:a(()=>e[36]||(e[36]=[s("取消")])),_:1}),t(d,{type:"primary",onClick:e[12]||(e[12]=o=>H(D.value))},{default:a(()=>e[37]||(e[37]=[s(" 确定 ")])),_:1})])]),default:a(()=>[t(I,{ref_key:"ruleFormRef",ref:D,model:l.form,rules:l.rules,"label-width":"120px",class:"demo-ruleForm"},{default:a(()=>[t(k,{gutter:20},{default:a(()=>[t(f,{span:12},{default:a(()=>[t(m,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(y,{modelValue:l.form.roleName,"onUpdate:modelValue":e[0]||(e[0]=o=>l.form.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:12},{default:a(()=>[t(m,{prop:"roleKey"},{label:a(()=>[p("div",Be,[t(se,{content:"控制器中定义的权限字符，如：@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:a(()=>[t(K,null,{default:a(()=>[t(re)]),_:1})]),_:1}),e[32]||(e[32]=s(" 权限字符 "))])]),default:a(()=>[t(y,{modelValue:l.form.roleKey,"onUpdate:modelValue":e[1]||(e[1]=o=>l.form.roleKey=o),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:20},{default:a(()=>[t(f,{span:12},{default:a(()=>[t(m,{label:"角色顺序",prop:"roleSort"},{default:a(()=>[t(de,{modelValue:l.form.roleSort,"onUpdate:modelValue":e[2]||(e[2]=o=>l.form.roleSort=o),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{span:12},{default:a(()=>[t(m,{label:"状态"},{default:a(()=>[t(fe,{class:"w100",dataType:"radio",dictCode:"sys_normal_disable",modelValue:l.form.status,"onUpdate:modelValue":e[3]||(e[3]=o=>l.form.status=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:20},{default:a(()=>[t(f,{span:24},{default:a(()=>[t(m,{label:"菜单权限",prop:"roleSort"},{default:a(()=>[p("div",null,[p("div",null,[t(c,{modelValue:l.menuExpand,"onUpdate:modelValue":e[4]||(e[4]=o=>l.menuExpand=o),onChange:e[5]||(e[5]=o=>U(o,"menu"))},{default:a(()=>e[33]||(e[33]=[s("展开/折叠")])),_:1},8,["modelValue"]),t(c,{modelValue:l.menuNodeAll,"onUpdate:modelValue":e[6]||(e[6]=o=>l.menuNodeAll=o),onChange:e[7]||(e[7]=o=>N(o,"menu"))},{default:a(()=>e[34]||(e[34]=[s("全选/全不选")])),_:1},8,["modelValue"]),t(c,{modelValue:l.form.menuCheckStrictly,"onUpdate:modelValue":e[8]||(e[8]=o=>l.form.menuCheckStrictly=o),onChange:e[9]||(e[9]=o=>R(o,"menu"))},{default:a(()=>e[35]||(e[35]=[s("父子联动")])),_:1},8,["modelValue"])]),t(A,{class:"tree-border",data:l.menuOptions,"show-checkbox":"",ref_key:"treeRef",ref:b,"node-key":"id","check-strictly":!l.form.menuCheckStrictly,"empty-text":"加载中，请稍候",props:l.defaultProps},null,8,["data","check-strictly","props"])])]),_:1})]),_:1})]),_:1}),t(k,null,{default:a(()=>[t(f,{span:24},{default:a(()=>[t(m,{label:"备注"},{default:a(()=>[t(y,{modelValue:l.form.remark,"onUpdate:modelValue":e[10]||(e[10]=o=>l.form.remark=o),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),Re(" 分配角色数据权限对话框 "),t(O,{title:l.title,modelValue:l.openDataScope,"onUpdate:modelValue":e[24]||(e[24]=o=>l.openDataScope=o),width:"500px","append-to-body":""},{footer:a(()=>[p("div",Pe,[t(d,{type:"primary",onClick:q},{default:a(()=>e[41]||(e[41]=[s("确 定")])),_:1}),t(d,{onClick:e[23]||(e[23]=o=>l.openDataScope=!1)},{default:a(()=>e[42]||(e[42]=[s("取 消")])),_:1})])]),default:a(()=>[t(I,{model:l.form,"label-width":"80px"},{default:a(()=>[t(m,{label:"角色名称"},{default:a(()=>[t(y,{modelValue:l.form.roleName,"onUpdate:modelValue":e[14]||(e[14]=o=>l.form.roleName=o),disabled:!0},null,8,["modelValue"])]),_:1}),t(m,{label:"权限字符"},{default:a(()=>[t(y,{modelValue:l.form.roleKey,"onUpdate:modelValue":e[15]||(e[15]=o=>l.form.roleKey=o),disabled:!0},null,8,["modelValue"])]),_:1}),t(m,{label:"权限范围"},{default:a(()=>[t(me,{modelValue:l.form.dataScope,"onUpdate:modelValue":e[16]||(e[16]=o=>l.form.dataScope=o),onChange:n.dataScopeSelectChange},{default:a(()=>[(x(!0),B(Ke,null,Te(l.dataScopeOptions,o=>(x(),Ae(ue,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),Ie(t(m,{label:"数据权限"},{default:a(()=>[t(c,{modelValue:l.deptExpand,"onUpdate:modelValue":e[17]||(e[17]=o=>l.deptExpand=o),onChange:e[18]||(e[18]=o=>U(o,"dept"))},{default:a(()=>e[38]||(e[38]=[s("展开/折叠")])),_:1},8,["modelValue"]),t(c,{modelValue:l.deptNodeAll,"onUpdate:modelValue":e[19]||(e[19]=o=>l.deptNodeAll=o),onChange:e[20]||(e[20]=o=>N(o,"dept"))},{default:a(()=>e[39]||(e[39]=[s("全选/全不选")])),_:1},8,["modelValue"]),t(c,{modelValue:l.form.deptCheckStrictly,"onUpdate:modelValue":e[21]||(e[21]=o=>l.form.deptCheckStrictly=o),onChange:e[22]||(e[22]=o=>R(o,"dept"))},{default:a(()=>e[40]||(e[40]=[s("父子联动")])),_:1},8,["modelValue"]),t(A,{class:"tree-border",data:l.deptOptions,"show-checkbox":"","default-expand-all":"",ref:"dept","node-key":"id","check-strictly":!l.form.deptCheckStrictly,"empty-text":"加载中，请稍候",props:l.defaultProps},null,8,["data","check-strictly","props"])]),_:1},512),[[Oe,l.form.dataScope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(we,{modelValue:V.value,"onUpdate:modelValue":e[25]||(e[25]=o=>V.value=o),id:C.value,onUpdate:i},null,8,["modelValue","id"])])}}}),Dl=_e($e,[["__file","D:/work/public/admin-tempalte-base/src/views/system/role/index.vue"]]);export{Dl as default};
