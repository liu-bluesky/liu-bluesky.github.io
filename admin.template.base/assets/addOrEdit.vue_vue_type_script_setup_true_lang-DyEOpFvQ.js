import"./vue-BM9Tihka.js";import{E as D}from"./element-easy-form-CSO3c5CP.js";import{d as U,e as q,g as F}from"./role-Doo_ayI_.js";import{d as J,e as P}from"./index-CEe7SyIl.js";import{t as z,r as L}from"./menu-C8kEVIrb.js";import{a as b}from"./element-plus-BPBmY4gL.js";import{d as j,r as c,A as H,w as V,i as y,m as W,k as r,u as E,o as G,a as C,j as u,q as i,n as I}from"./@vue-BKq3Py-p.js";const le=j({__name:"addOrEdit",props:{modelValue:{type:Boolean,defalut:!1},id:{type:String,defalut:""}},emits:["update:modelValue","update"],setup(v,{emit:x}){const k=x,f=c(!1),A=c(!1),N=c(),_=()=>{let e=m.value.getCheckedKeys(),l=m.value.getHalfCheckedKeys();return e.unshift.apply(e,l),e},w=async()=>{try{const e=await N.value.validate();n.value.model.menuIds=_(),d.id?U(e).then(l=>{b.success(t("操作成功")),h(),k("update")}):q(e).then(l=>{b.success(t("操作成功")),h(),k("update")})}catch(e){console.log("error :>> ",e)}},a=H({menuOptions:[],menuExpand:!1,menuNodeAll:!1}),n=c({schema:[{label:"角色名称",prop:"roleName",colAttrs:{span:12},componentName:"ElInput",attrs:{placeholder:"请输入"},rules:[{required:!0,message:"不能为空",trigger:"change"}]},{label:"权限字符",prop:"roleKey",colAttrs:{span:12},componentName:"ElInput",attrs:{placeholder:"请选择"},rules:[{required:!1,message:"不能为空",trigger:"change"}]},{label:"角色顺序",prop:"roleSort",colAttrs:{span:12},componentName:"ElInputNumber",attrs:{placeholder:"请输入",precision:2,"controls-position":"right",...P}},{label:"邮箱",prop:"email",colAttrs:{span:12},componentName:"ElInput",attrs:{type:"number",placeholder:"请选择"}},{label:"用户名称",prop:"userName",colAttrs:{span:12},componentName:"ElInput",hidden:(e,l)=>l.userId!=null,attrs:{placeholder:"请输入"}},{label:"状态",prop:"status",colAttrs:{span:12},componentName:"selectDict",attrs:{dictCode:"sys_normal_disable",placeholder:"请选择",showPassword:!0}},{label:"菜单权限",prop:"menuIds",colAttrs:{span:12},componentName:"ElInput",attrs:{}},{label:"备注",type:"COMPONENT",formItemAttrs:{},attrs:{placeholder:"请输入",type:"textarea"},rules:[],prop:"remark",componentName:"ElInput",colAttrs:{span:24}}],model:{}});let d=v;const m=c(),K=()=>{z().then(e=>{a.menuOptions=e.data})},O=()=>{const e=T(d.id);F(d.id).then(l=>{n.value.model=l.data,I(()=>{e.then(s=>{s.checkedKeys.forEach(g=>{I(()=>{m.value.setChecked(g,!0,!1)})})})})})},T=e=>L(e).then(l=>(a.menuOptions=l.menus,l));V(()=>d.modelValue,e=>{f.value=e,console.log("props.id :>> ",d.id),d.id&&e?O():!d.id&&e&&(K(),n.value.model={})},{immediate:!0});const M=(e,l)=>{{let s=a.menuOptions;for(let p=0;p<s.length;p++)m.value.store.nodesMap[s[p].id].expanded=e}},R=(e,l)=>{m.value.setCheckedNodes(e?a.menuOptions:[])},S=(e,l)=>{n.value.model.menuCheckStrictly=!!e},h=()=>{k("update:modelValue",!1)};return V(()=>f.value,e=>{e||h()}),(e,l)=>{const s=y("el-checkbox"),p=y("el-tree"),g=y("el-button"),B=y("ComDialog");return G(),W(B,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=o=>f.value=o),width:E(J),title:v.id?"编辑":"新增"},{footer:r(()=>[C("div",null,[u(g,{size:"large",onClick:h},{default:r(()=>[i("取消")]),_:1}),u(g,{size:"large",loading:A.value,type:"primary",onClick:w},{default:r(()=>[i("保存")]),_:1},8,["loading"])])]),default:r(()=>[u(E(D),{ref_key:"comFromRef",ref:N,formJson:n.value},{menuIds:r(()=>[C("div",null,[C("div",null,[u(s,{modelValue:a.menuExpand,"onUpdate:modelValue":l[0]||(l[0]=o=>a.menuExpand=o),onChange:l[1]||(l[1]=o=>M(o,"menu"))},{default:r(()=>[i("展开/折叠")]),_:1},8,["modelValue"]),u(s,{modelValue:a.menuNodeAll,"onUpdate:modelValue":l[2]||(l[2]=o=>a.menuNodeAll=o),onChange:l[3]||(l[3]=o=>R(o,"menu"))},{default:r(()=>[i("全选/全不选")]),_:1},8,["modelValue"]),u(s,{modelValue:n.value.model.menuCheckStrictly,"onUpdate:modelValue":l[4]||(l[4]=o=>n.value.model.menuCheckStrictly=o),onChange:l[5]||(l[5]=o=>S(o,"menu"))},{default:r(()=>[i("父子联动")]),_:1},8,["modelValue"])]),u(p,{class:"tree-border",data:a.menuOptions,"show-checkbox":"",ref_key:"treeRef",ref:m,"node-key":"id","check-strictly":!n.value.model.menuCheckStrictly,"empty-text":"加载中，请稍候",props:a.defaultProps},null,8,["data","check-strictly","props"])])]),_:1},8,["formJson"])]),_:1},8,["modelValue","width","title"])}}});export{le as _};
