import"./vue-BJVn-AwR.js";import{E as q}from"./element-easy-form-Dt0ABKHq.js";import{b as B,c as F,d as J,a as S}from"./user-BHfcmfyL.js";import{d as z,g as L}from"./index-krqcOEfN.js";import{b as M}from"./config-DLSRAfBl.js";import{a as _}from"./element-plus-DTmgdQLG.js";import{d as R,r as c,i as j,w as V,j as p,t as f,l as s,u as N,o as u,a as K,k as d,A as E,c as k,q as A,F as C}from"./@vue-BrpAZT_d.js";const Z=R({__name:"addOrEdit",props:{modelValue:{type:Boolean,defalut:!1},id:{type:String,defalut:""}},emits:["update:modelValue","update"],setup(b,{emit:O}){const g=O,m=c(!1),x=c(!1),h=c(),P=async()=>{try{const e=await h.value.validate();n.id?B(e).then(a=>{_.success(t("操作成功")),i(),g("update")}):F(e).then(a=>{_.success(t("操作成功")),i(),g("update")})}catch(e){console.log("error :>> ",e)}},r=j({deptOptions:[],postOptions:[],roleOptions:[],initPassword:""}),o=c({schema:[{label:"用户昵称",prop:"nickName",colAttrs:{span:12},componentName:"ElInput",attrs:{placeholder:"请输入名字"},rules:[{required:!0,message:"不能为空",trigger:"change"}]},{label:"归属部门",prop:"deptId",colAttrs:{span:12},componentName:"ElDatePicker",attrs:{placeholder:"请选择"},rules:[{required:!1,message:"不能为空",trigger:"change"}]},{label:"手机号码",prop:"phonenumber",colAttrs:{span:12},componentName:"ElInput",rules:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],attrs:{type:"number",placeholder:"请选择"}},{label:"邮箱",prop:"email",colAttrs:{span:12},componentName:"ElInput",rules:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],attrs:{type:"number",placeholder:"请选择"}},{label:"用户名称",prop:"userName",colAttrs:{span:12},rules:[{required:!0,message:"不能为空",trigger:"change"}],componentName:"ElInput",hidden:(e,a)=>a.userId!=null,attrs:{placeholder:"请输入"}},{label:"用户密码",prop:"password",colAttrs:{span:12},rules:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"}],componentName:"ElInput",hidden:(e,a)=>a.userId!=null,attrs:{maxlength:"20",placeholder:"请输入",showPassword:!0}},{label:"性别",prop:"sex",colAttrs:{span:12},componentName:"selectDict",attrs:{dictCode:"sys_user_sex",placeholder:"请选择",showPassword:!0}},{label:"状态",prop:"status",colAttrs:{span:12},componentName:"selectDict",attrs:{dictCode:"sys_normal_disable",placeholder:"请选择",showPassword:!0}},{label:"岗位",prop:"postIds",colAttrs:{span:12},componentName:"ElInput",attrs:{}},{label:"角色",prop:"roleIds",colAttrs:{span:12},componentName:"ElInput",attrs:{}},{label:"备注",type:"COMPONENT",formItemAttrs:{},attrs:{placeholder:"请输入",type:"textarea"},rules:[],prop:"remark",componentName:"ElInput",colAttrs:{span:24}}],model:{}});let n=b;const I=()=>{J().then(e=>{r.deptOptions=e.data})},D=()=>{M("sys.user.initPassword").then(e=>{r.initPassword=e.msg}),S(n.id).then(e=>{o.value.model=e.data,r.postOptions=e.posts,r.roleOptions=e.roles,o.value.password||(o.value.model.password=r.initPassword),o.value.model.areaType=L(e.data.areaType)})};V(()=>n.modelValue,e=>{m.value=e,console.log("props.id :>> ",n.id),n.id&&e?(D(),I()):!n.id&&e&&(I(),o.value.model={sex:"1"})},{immediate:!0});const i=()=>{g("update:modelValue",!1)};return V(()=>m.value,e=>{e||i()}),(e,a)=>{const U=p("el-cascader"),v=p("el-option"),w=p("el-select"),y=p("el-button"),T=p("ComDialog");return u(),f(T,{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=l=>m.value=l),width:N(z),title:b.id?"编辑":"新增"},{footer:s(()=>[K("div",null,[d(y,{size:"large",onClick:i},{default:s(()=>[E("取消")]),_:1}),d(y,{size:"large",loading:x.value,type:"primary",onClick:P},{default:s(()=>[E("保存")]),_:1},8,["loading"])])]),default:s(()=>[d(N(q),{ref_key:"comFromRef",ref:h,formJson:o.value},{deptId:s(()=>[d(U,{class:"w100",options:r.deptOptions,modelValue:o.value.model.deptId,"onUpdate:modelValue":a[0]||(a[0]=l=>o.value.model.deptId=l),props:{value:"id",emitPath:!1,checkStrictly:!0},clearable:""},null,8,["options","modelValue"])]),postIds:s(()=>[d(w,{class:"w100",modelValue:o.value.model.postIds,"onUpdate:modelValue":a[1]||(a[1]=l=>o.value.model.postIds=l),multiple:"",placeholder:"请选择岗位"},{default:s(()=>[(u(!0),k(C,null,A(r.postOptions,l=>(u(),f(v,{key:l.postId,label:l.postName,value:l.postId,disabled:l.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),roleIds:s(()=>[d(w,{class:"w100",modelValue:o.value.model.roleIds,"onUpdate:modelValue":a[2]||(a[2]=l=>o.value.model.roleIds=l),multiple:"",placeholder:"请选择岗位"},{default:s(()=>[(u(!0),k(C,null,A(r.roleOptions,l=>(u(),f(v,{key:l.roleId,label:l.roleName,value:l.roleId,disabled:l.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["formJson"])]),_:1},8,["modelValue","width","title"])}}});export{Z as _};
