import"./vue-C5dO_luG.js";import{u as Z,a as ee}from"./vue-router-BozZHOWV.js";import{h as w,f as J}from"./index-CkfvThUu.js";import{D as Q}from"./index-DoWSHu4Y.js";import{d as $,v as g,f as L,h as i,o as x,c as O,i as e,j as t,a as M,m as c,ac as F,F as te,k as le,l as ae,D as oe,u as N,t as re,r as k}from"./@vue-CEwL1emF.js";import{a as se,b as E}from"./element-plus-DMVJK10x.js";import"./ace-builds-BgbZLK3Y.js";import"./vuex-Ba7ek5fU.js";import"./path-browserify-CtykbOjM.js";import"./@vueuse-DfzPTH68.js";import"./axios-DHSC6jYe.js";import"./js-cookie-Cz0CWeBA.js";import"./nprogress-DI8p4ty5.js";import"./@element-plus-DNaH03KG.js";/* empty css                    */import"./dayjs-CdRyolhI.js";import"./element-easy-form-4sEWskrm.js";import"./mockjs-DBNDAG0j.js";import"./vuedraggable-CHX8LlEE.js";import"./sortablejs-Df4VMxQp.js";import"./vue3-ace-editor-D2yfFFZ4.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./uuid-D8aEg3BZ.js";import"./lodash-es-WEemOz_S.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-D3FX-SGt.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-CtcGg-6p.js";function j(d){return w.request({url:"/system/role/authUser/allocatedList",method:"get",params:d})}function ne(d){return w.request({url:"/system/role/authUser/unallocatedList",method:"get",params:d})}function ue(d){return w.request({url:"/system/role/authUser/cancel",method:"put",data:d})}function ie(d){return w.request({url:"/system/role/authUser/selectAll",method:"put",params:d})}const pe={class:"dialog-footer"},me=$({__name:"selectUser",props:{roleId:{type:[Number,String],required:!0}},emits:["getUsers"],setup(d,{expose:v,emit:R}){const K=R,a=g({userVisible:!1,loading:!1,selection:[],userIds:[],tableData:[],columnData:[{label:"用户名称",prop:"userName"},{label:"用户昵称",prop:"nickName"},{label:"邮箱",prop:"email"},{label:"手机",prop:"phonenumber"},{label:"状态",prop:"status",render:!0},{label:"创建时间",prop:"createTime",render:!0}]});v({show:()=>{p.roleId=q.roleId,a.userVisible=!0,U(),h()},hide:()=>{a.userVisible=!1}});const b={pageNum:1,pageSize:10,userName:"",phonenumber:""},p=g(JSON.parse(JSON.stringify(b))),l=()=>{p.pageNum=1,h()},n=g({currentPage:1,total:10,pageSize:10,pageSizes:[10,20,30,40],layout:"total, prev, pager, next,sizes"}),h=()=>{a.loading=!0,p.pageNum=n.currentPage,p.pageSize=n.pageSize,ne(p).then(r=>{a.tableData=r.rows,n.total=r.total,a.loading=!1})},B=r=>{a.selection=r,a.userIds=r.map(s=>s.userId)},S=()=>{K("getUsers",{selection:a.selection,ids:a.userIds})},U=()=>{Object.assign(p,b),l()},q=d,P=r=>{n.pageSize=r,h()},D=r=>{n.currentPage=r,h()};let o=g({sys_normal_disable:[]});const{parseTime:m,getDict:_}=J();return L(async()=>{o.sys_normal_disable=await _("sys_normal_disable")}),(r,s)=>{const C=i("el-input"),z=i("el-form-item"),y=i("el-button"),f=i("el-form"),A=i("el-table-column"),G=i("el-table"),H=i("el-pagination"),W=i("el-skeleton"),X=i("el-dialog");return x(),O("div",null,[e(X,{modelValue:a.userVisible,"onUpdate:modelValue":s[4]||(s[4]=u=>a.userVisible=u),title:a.title,width:"50%","destroy-on-close":"",center:""},{footer:t(()=>[M("span",pe,[e(y,{onClick:s[3]||(s[3]=u=>a.userVisible=!1)},{default:t(()=>[c("取消")]),_:1}),e(y,{type:"primary",onClick:S},{default:t(()=>[c(" 确定 ")]),_:1})])]),default:t(()=>[e(f,{model:p,ref:"queryForm",size:"small",inline:!0},{default:t(()=>[e(z,{label:"用户名称",prop:"userName"},{default:t(()=>[e(C,{modelValue:p.userName,"onUpdate:modelValue":s[0]||(s[0]=u=>p.userName=u),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:F(l,["enter","native"])},null,8,["modelValue"])]),_:1}),e(z,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[e(C,{modelValue:p.phonenumber,"onUpdate:modelValue":s[1]||(s[1]=u=>p.phonenumber=u),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:F(l,["enter","native"])},null,8,["modelValue"])]),_:1}),e(z,null,{default:t(()=>[e(y,{type:"primary",size:"mini",onClick:l},{default:t(()=>[c("搜索")]),_:1}),e(y,{size:"mini",onClick:U},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"]),e(W,{class:"p20",loading:a.height==0,animated:"",rows:19},{default:t(()=>[e(G,{height:"300px",data:a.tableData,onSelectionChange:B},{default:t(()=>[e(A,{type:"selection",width:"55"}),(x(!0),O(te,null,le(a.columnData,(u,Y)=>(x(),ae(A,{key:Y,label:u.label,prop:u.prop},oe({_:2},[u.render&&u.prop=="status"?{name:"default",fn:t(T=>[e(Q,{values:T.row.status,options:N(o).sys_normal_disable},null,8,["values","options"])]),key:"0"}:void 0,u.render&&u.prop=="createTime"?{name:"default",fn:t(T=>[c(re(N(m)(T.row.createTime)),1)]),key:"1"}:void 0]),1032,["label","prop"]))),128))]),_:1},8,["data"]),e(H,{class:"paginationBox",currentPage:n.currentPage,"onUpdate:currentPage":s[2]||(s[2]=u=>n.currentPage=u),"page-size":n.pageSize,layout:n.layout,"page-sizes":n.pageSizes,total:n.total,onSizeChange:P,onCurrentChange:D},null,8,["currentPage","page-size","layout","page-sizes","total"])]),_:1},8,["loading"])]),_:1},8,["modelValue","title"])])}}}),de=me,ce={class:"white-bg commonBoxmp"},ge={class:"jcb aic w100"},Qe=$({__name:"authUser",setup(d){Z();const v=ee(),{parseTime:R,addDateRange:K,getDict:a}=J();k(!0);const I=k(),V=g({openDataScope:!1,defaultProps:{children:"children",label:"label"},menuOptions:[],deptOptions:[],deptExpand:!1,deptNodeAll:!1,menuExpand:!1,menuNodeAll:!1,title:"",form:{},userVisible:!1,rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]},dateRange:[],height:0,tableData:[],columnData:[{label:"用户名称",visible:!0,prop:"userName"},{label:"用户昵称",visible:!0,prop:"nickName"},{label:"邮箱",visible:!0,prop:"email"},{label:"手机",prop:"phonenumber",visible:!0},{label:"状态",visible:!0,prop:"status",render:({row:o})=>e(Q,{values:o.status,dataType:"primary",options:D.sys_normal_disable},null)},{label:"创建时间",visible:!0,prop:"createTime"}],loading:!1}),b=g({currentPage:1,total:10,pageSize:10,pageSizes:[10,20,30,40],layout:"total, prev, pager, next,sizes"}),p={pageNum:1,pageSize:10,userName:"",phonenumber:""},l=g(JSON.parse(JSON.stringify(p))),n=()=>{l.pageNum=1;let o=N(l);I.value.getList(o)},h=()=>{Object.assign(l,p),n()},B=o=>{const m=l.roleId;se.confirm('确认要取消该用户"'+o.userName+'"角色吗？').then(function(){return ue({userId:o.userId,roleId:m})}).then(()=>{E.success("取消授权成功")}).catch(function(){})};let S=k();const U=()=>{S.value.show()},q=()=>{V.loading=!0,l.pageNum=b.currentPage,l.pageSize=b.pageSize,j(l).then(o=>{V.tableData=o.rows,b.total=o.total,V.loading=!1})};k();const P=o=>{const m=l.roleId,_=o.ids.join(",");if(_==""){E.error("请选择要分配的用户");return}ie({roleId:m,userIds:_}).then(r=>{E.success(r.msg),r.code===200&&S.value.hide()})};let D=g({sys_normal_disable:[]});return L(async()=>{D.sys_normal_disable=await a("sys_normal_disable"),q()}),L(()=>{const o=v.params&&v.params.roleId;if(o){l.roleId=o;let m=N(l);I.value.getList(m)}}),(o,m)=>{const _=i("el-input"),r=i("el-form-item"),s=i("el-button"),C=i("el-form"),z=i("el-table-column"),y=i("TableV2");return x(),O("div",ce,[e(y,{class:"flex1",apiFunction:N(j),ref_key:"tableV2Ref",ref:I,columns:V.columnData},{tableHeader:t(()=>[M("div",ge,[e(C,{model:l,ref:"queryForm",size:"small",inline:!0},{default:t(()=>[e(r,{label:"用户名称",prop:"userName"},{default:t(()=>[e(_,{modelValue:l.userName,"onUpdate:modelValue":m[0]||(m[0]=f=>l.userName=f),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:F(n,["enter","native"])},null,8,["modelValue"])]),_:1}),e(r,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[e(_,{modelValue:l.phonenumber,"onUpdate:modelValue":m[1]||(m[1]=f=>l.phonenumber=f),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:F(n,["enter","native"])},null,8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(s,{type:"primary",size:"mini",onClick:n},{default:t(()=>[c("搜索")]),_:1}),e(s,{size:"mini",onClick:h},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"]),e(s,{type:"primary",onClick:U},{default:t(()=>[c("添加用户")]),_:1})])]),operation:t(()=>[e(z,{label:"操作",fixed:"right",width:"160px",align:"left"},{default:t(f=>[e(s,{type:"text",onClick:A=>B(f.row)},{default:t(()=>[c("取消授权")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["apiFunction","columns"]),e(de,{ref_key:"selectUserRef",ref:S,onGetUsers:P,roleId:N(v).params.roleId},null,8,["roleId"])])}}});export{Qe as default};
